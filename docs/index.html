<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tomasz Woźniak">
<meta name="author" content="Stephan Berke">
<meta name="author" content="Gezhi Chen">
<meta name="author" content="Ben Gussen">
<meta name="author" content="Inhye Kang">
<meta name="author" content="Zheyuan Li">
<meta name="author" content="Rui Liu">
<meta name="author" content="Qingqing Pang">
<meta name="author" content="Nhu Pham">
<meta name="author" content="Pun Suparattanapinan">
<meta name="author" content="Yansong Yang">
<meta name="author" content="Yuqiao Yang">

<title>Macroeconometrics Students Present - Bayesian Unobserved Component Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Macroeconometrics Students Present</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/donotdespair/Bayesian-Unobserved-Component-Models" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#unobserved-component-models" id="toc-unobserved-component-models" class="nav-link active" data-scroll-target="#unobserved-component-models">Unobserved component models</a></li>
  <li><a href="#a-simple-local-level-model" id="toc-a-simple-local-level-model" class="nav-link" data-scroll-target="#a-simple-local-level-model">A simple local-level model</a>
  <ul class="collapse">
  <li><a href="#matrix-notation-for-the-model" id="toc-matrix-notation-for-the-model" class="nav-link" data-scroll-target="#matrix-notation-for-the-model">Matrix notation for the model</a></li>
  <li><a href="#likelihood-function" id="toc-likelihood-function" class="nav-link" data-scroll-target="#likelihood-function">Likelihood function</a></li>
  <li><a href="#prior-distributions" id="toc-prior-distributions" class="nav-link" data-scroll-target="#prior-distributions">Prior distributions</a></li>
  </ul></li>
  <li><a href="#bayesian-estimation" id="toc-bayesian-estimation" class="nav-link" data-scroll-target="#bayesian-estimation">Bayesian estimation</a>
  <ul class="collapse">
  <li><a href="#derivation-of-full-conditional-posterior-distributions" id="toc-derivation-of-full-conditional-posterior-distributions" class="nav-link" data-scroll-target="#derivation-of-full-conditional-posterior-distributions">Derivation of full conditional posterior distributions</a></li>
  <li><a href="#gibbs-sampler" id="toc-gibbs-sampler" class="nav-link" data-scroll-target="#gibbs-sampler">Gibbs sampler</a></li>
  <li><a href="#simulation-smoother-and-precision-sampler" id="toc-simulation-smoother-and-precision-sampler" class="nav-link" data-scroll-target="#simulation-smoother-and-precision-sampler">Simulation smoother and precision sampler</a>
  <ul class="collapse">
  <li><a href="#simulation-smoother-algorithm-in-r" id="toc-simulation-smoother-algorithm-in-r" class="nav-link" data-scroll-target="#simulation-smoother-algorithm-in-r">Simulation smoother algorithm in R</a></li>
  </ul></li>
  <li><a href="#analytical-solution-for-a-joint-posterior-distribution" id="toc-analytical-solution-for-a-joint-posterior-distribution" class="nav-link" data-scroll-target="#analytical-solution-for-a-joint-posterior-distribution">Analytical solution for a joint posterior distribution</a>
  <ul class="collapse">
  <li><a href="#prior-distributions-1" id="toc-prior-distributions-1" class="nav-link" data-scroll-target="#prior-distributions-1">Prior distributions</a></li>
  <li><a href="#the-joint-posterior-distribution" id="toc-the-joint-posterior-distribution" class="nav-link" data-scroll-target="#the-joint-posterior-distribution">The Joint Posterior Distribution</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#hierarchical-modeling" id="toc-hierarchical-modeling" class="nav-link" data-scroll-target="#hierarchical-modeling">Hierarchical modeling</a>
  <ul class="collapse">
  <li><a href="#estimating-gamma-error-term-variance-prior-scale" id="toc-estimating-gamma-error-term-variance-prior-scale" class="nav-link" data-scroll-target="#estimating-gamma-error-term-variance-prior-scale">Estimating gamma error term variance prior scale</a></li>
  <li><a href="#estimating-inverted-gamma-2-error-term-variance-prior-scale" id="toc-estimating-inverted-gamma-2-error-term-variance-prior-scale" class="nav-link" data-scroll-target="#estimating-inverted-gamma-2-error-term-variance-prior-scale">Estimating inverted-gamma 2 error term variance prior scale</a></li>
  <li><a href="#estimating-the-initial-condition-prior-scale" id="toc-estimating-the-initial-condition-prior-scale" class="nav-link" data-scroll-target="#estimating-the-initial-condition-prior-scale">Estimating the initial condition prior scale</a></li>
  <li><a href="#student-t-prior-for-the-trend-component" id="toc-student-t-prior-for-the-trend-component" class="nav-link" data-scroll-target="#student-t-prior-for-the-trend-component">Student-t prior for the trend component</a></li>
  <li><a href="#estimating-student-t-degrees-of-freedom-parameter" id="toc-estimating-student-t-degrees-of-freedom-parameter" class="nav-link" data-scroll-target="#estimating-student-t-degrees-of-freedom-parameter">Estimating Student-t degrees of freedom parameter</a></li>
  <li><a href="#laplace-prior-for-the-trend-component" id="toc-laplace-prior-for-the-trend-component" class="nav-link" data-scroll-target="#laplace-prior-for-the-trend-component">Laplace prior for the trend component</a>
  <ul class="collapse">
  <li><a href="#full-conditional-posterior-distribution-for-tautau_0sigma2omega" id="toc-full-conditional-posterior-distribution-for-tautau_0sigma2omega" class="nav-link" data-scroll-target="#full-conditional-posterior-distribution-for-tautau_0sigma2omega">Full-conditional posterior distribution for <span class="math inline">\(\tau|\tau_0,\sigma^2,\Omega\)</span></a></li>
  <li><a href="#full-conditional-posterior-distribution-for-lambda_tytausigma_eta2" id="toc-full-conditional-posterior-distribution-for-lambda_tytausigma_eta2" class="nav-link" data-scroll-target="#full-conditional-posterior-distribution-for-lambda_tytausigma_eta2">Full-conditional posterior distribution for <span class="math inline">\(\lambda_t|y,\tau,\sigma_\eta^2\)</span></a></li>
  <li><a href="#r-function-for-gibbs-sampler" id="toc-r-function-for-gibbs-sampler" class="nav-link" data-scroll-target="#r-function-for-gibbs-sampler">R Function for Gibbs Sampler</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#model-extensions" id="toc-model-extensions" class="nav-link" data-scroll-target="#model-extensions">Model extensions</a>
  <ul class="collapse">
  <li><a href="#estimation-of-autoregressive-parameters-for-cycle-component" id="toc-estimation-of-autoregressive-parameters-for-cycle-component" class="nav-link" data-scroll-target="#estimation-of-autoregressive-parameters-for-cycle-component">Estimation of autoregressive parameters for cycle component</a></li>
  <li><a href="#autoregressive-cycle-component" id="toc-autoregressive-cycle-component" class="nav-link" data-scroll-target="#autoregressive-cycle-component">Autoregressive cycle component</a>
  <ul class="collapse">
  <li><a href="#the-prior-distribution" id="toc-the-prior-distribution" class="nav-link" data-scroll-target="#the-prior-distribution">The prior distribution</a></li>
  <li><a href="#likelihood" id="toc-likelihood" class="nav-link" data-scroll-target="#likelihood">Likelihood</a></li>
  <li><a href="#the-full-conditional-posterior-distribution" id="toc-the-full-conditional-posterior-distribution" class="nav-link" data-scroll-target="#the-full-conditional-posterior-distribution">The full-conditional posterior distribution</a></li>
  <li><a href="#the-sampler-function" id="toc-the-sampler-function" class="nav-link" data-scroll-target="#the-sampler-function">The Sampler function</a></li>
  </ul></li>
  <li><a href="#random-walk-with-time-varying-drift-parameter" id="toc-random-walk-with-time-varying-drift-parameter" class="nav-link" data-scroll-target="#random-walk-with-time-varying-drift-parameter">Random walk with time-varying drift parameter</a></li>
  <li><a href="#student-t-error-terms" id="toc-student-t-error-terms" class="nav-link" data-scroll-target="#student-t-error-terms">Student-t error terms</a></li>
  <li><a href="#conditional-heteroskedasticity" id="toc-conditional-heteroskedasticity" class="nav-link" data-scroll-target="#conditional-heteroskedasticity">Conditional heteroskedasticity</a>
  <ul class="collapse">
  <li><a href="#basic-model" id="toc-basic-model" class="nav-link" data-scroll-target="#basic-model">Basic model</a></li>
  <li><a href="#algorithm" id="toc-algorithm" class="nav-link" data-scroll-target="#algorithm">Algorithm</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#bayesian-forecasting" id="toc-bayesian-forecasting" class="nav-link" data-scroll-target="#bayesian-forecasting">Bayesian forecasting</a>
  <ul class="collapse">
  <li><a href="#predictive-density" id="toc-predictive-density" class="nav-link" data-scroll-target="#predictive-density">Predictive density</a></li>
  <li><a href="#sampling-from-the-predictive-density" id="toc-sampling-from-the-predictive-density" class="nav-link" data-scroll-target="#sampling-from-the-predictive-density">Sampling from the predictive density</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Bayesian Unobserved Component Models</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://github.com/donotdespair">Tomasz Woźniak</a> <a href="https://orcid.org/0000-0003-2212-2378" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
             <p><a href="https://github.com/sb955/">Stephan Berke</a> <a href="https://orcid.org/0009-0004-8443-1453" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
             <p><a href="https://github.com/cora1ine">Gezhi Chen</a> </p>
             <p><a href="https://github.com/bgussen">Ben Gussen</a> <a href="https://orcid.org/0000-0003-4406-4076" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
             <p><a href="https://github.com/inhyekang-au">Inhye Kang</a> <a href="https://orcid.org/0009-0007-8544-4952" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
             <p><a href="https://github.com/lzyzero3">Zheyuan Li</a> </p>
             <p><a href="https://github.com/rruiliu1005">Rui Liu</a> <a href="https://orcid.org/0009-0008-9348-8581" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
             <p><a href="https://github.com/comeseemeintheocean">Qingqing Pang</a> </p>
             <p><a href="https://github.com/NhuPham254">Nhu Pham</a> </p>
             <p><a href="https://github.com/Punzbd">Pun Suparattanapinan</a> </p>
             <p><a href="https://github.com/russellyang728">Yansong Yang</a> </p>
             <p><a href="https://github.com/JimmyYang917">Yuqiao Yang</a> </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<blockquote class="blockquote">
<p><strong>Abstract.</strong> We present the basics of Bayesian estimation and inference for unobserved component models on the example of a local-level model. The range of topics includes the conjugate prior analysis using normal-inverted-gamma 2 distribution and its extensions focusing on hierarchical modelling, conditional heteroskedasticity, and Student-t error terms. We scrutinise Bayesian forecasting and sampling from the predictive density.</p>
<p><strong>Keywords.</strong> Unobserved Component Models, Local-Level Model, State-Space Bayesian Inference, Forecasting, Heteroskedasticity, Hierarchical Modelling, Gibbs Sampler, Simulation Smoother, Precision Sampling</p>
</blockquote>
<section id="unobserved-component-models" class="level1">
<h1>Unobserved component models</h1>
<p>Unobserved Component (UC) models are a popular class of models in macroeconometrics that use the state-space representation for unit-root nonstationary time series. The simple formulation of the model equations decomposing the series into a non-stationary and stationary component facilitates economic interpretations and good forecasting performance.</p>
</section>
<section id="a-simple-local-level-model" class="level1">
<h1>A simple local-level model</h1>
<p>The model is set for a univariate time series whose observation at time <span class="math inline">\(t\)</span> is denoted by <span class="math inline">\(y_t\)</span>. It decomposes the variable into a stochastic trend component, <span class="math inline">\(\tau_t\)</span>, and a stationary error component, <span class="math inline">\(\epsilon_t\)</span>. The former follows a Gaussian random walk process with the conditional variance <span class="math inline">\(\sigma_\eta^2\)</span>, and the latter is zero-mean normally distributed with the variance <span class="math inline">\(\sigma^2\)</span>. These are expressed as the model equations:</p>
<p><span class="math display">\[
\begin{align}
y_t &amp;= \tau_t + \epsilon_t,\\
\tau_t &amp;= \tau_{t-1} + \eta_t,\\
\epsilon_t &amp;\sim\mathcal{N}\left(0, \sigma^2\right),\\
\eta_t &amp;\sim\mathcal{N}\left(0, \sigma_\eta^2\right),
\end{align}
\]</span> where the initial condition <span class="math inline">\(\tau_0\)</span> is a parameter of the model.</p>
<section id="matrix-notation-for-the-model" class="level2">
<h2 class="anchored" data-anchor-id="matrix-notation-for-the-model">Matrix notation for the model</h2>
<p>To simplify the notation and the derivations introduce matrix notation for the model. Let <span class="math inline">\(T\)</span> be the available sample size for the variable <span class="math inline">\(y\)</span>. Define a <span class="math inline">\(T\)</span>-vector of zeros, <span class="math inline">\(\mathbf{0}_T\)</span>, and of ones, <span class="math inline">\(\boldsymbol\imath_T\)</span>, the identity matrix of order <span class="math inline">\(T\)</span>, <span class="math inline">\(\mathbf{I}_T\)</span>, as well as <span class="math inline">\(T\times1\)</span> vectors:</p>
<p><span class="math display">\[
\begin{align}
\mathbf{y} = \begin{bmatrix} y_1\\ \vdots\\ y_T \end{bmatrix},\quad
\boldsymbol\tau = \begin{bmatrix} \tau_1\\ \vdots\\ \tau_T \end{bmatrix},\quad
\boldsymbol\epsilon = \begin{bmatrix} \epsilon_1\\ \vdots\\ \epsilon_T \end{bmatrix},\quad
\boldsymbol\eta = \begin{bmatrix} \eta_1\\ \vdots\\ \eta_T \end{bmatrix},\qquad
\mathbf{i} = \begin{bmatrix} 1\\0\\ \vdots\\ 0 \end{bmatrix},
\end{align}
\]</span> and a <span class="math inline">\(T\times T\)</span> matrix <span class="math inline">\(\mathbf{H}\)</span> with the elements:</p>
<p><span class="math display">\[
\begin{align}
\mathbf{H} = \begin{bmatrix}
1 &amp; 0 &amp; \cdots &amp; 0 &amp; 0\\
-1 &amp; 1 &amp; \cdots &amp; 0 &amp; 0\\
0 &amp; -1 &amp; \cdots &amp; 0 &amp; 0\\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots\\
0 &amp; 0 &amp; \cdots &amp; 1 &amp; 0\\
0 &amp; 0 &amp; \cdots &amp; -1 &amp; 1
\end{bmatrix}.
\end{align}
\]</span></p>
<p>Then the model can be written in a concise notation as: <span class="math display">\[
\begin{align}
\mathbf{y} &amp;= \mathbf{\tau} + \boldsymbol\epsilon,\\
\mathbf{H}\boldsymbol\tau &amp;= \mathbf{i} \tau_0 + \boldsymbol\eta,\\
\boldsymbol\epsilon &amp;\sim\mathcal{N}\left(\mathbf{0}_T, \sigma^2\mathbf{I}_T\right),\\
\boldsymbol\eta &amp;\sim\mathcal{N}\left(\mathbf{0}_T, \sigma_\eta^2\mathbf{I}_T\right).
\end{align}
\]</span></p>
</section>
<section id="likelihood-function" class="level2">
<h2 class="anchored" data-anchor-id="likelihood-function">Likelihood function</h2>
<p>The model equations imply the predictive density of the data vector <span class="math inline">\(\mathbf{y}\)</span>. To see this, consider the model equation as a linear transformation of a normal vector <span class="math inline">\(\boldsymbol\epsilon\)</span>. Therefore, the data vector follows a multivariate normal distribution given by: <span class="math display">\[
\begin{align}
\mathbf{y}\mid \boldsymbol\tau, \sigma^2 &amp;\sim\mathcal{N}_T\left(\boldsymbol\tau, \sigma^2\mathbf{I}_T\right).
\end{align}
\]</span></p>
<p>This distribution determines the shape of the likelihood function that is defined as the sampling data density: <span class="math display">\[
\begin{align}
L(\boldsymbol\tau,\sigma^2|\mathbf{y})\equiv p\left(\mathbf{y}\mid\boldsymbol\tau, \sigma^2 \right).
\end{align}
\]</span></p>
<p>The likelihood function that for the sake of the estimation of the parameters, and after plugging in data in place of <span class="math inline">\(\mathbf{y}\)</span>, is considered a function of parameters <span class="math inline">\(\boldsymbol\tau\)</span> and <span class="math inline">\(\sigma^2\)</span> is given by: <span class="math display">\[
\begin{align}
L(\boldsymbol\tau,\sigma^2|\mathbf{y}) =
(2\pi)^{-\frac{T}{2}}\left(\sigma^2\right)^{-\frac{T}{2}}\exp\left\{-\frac{1}{2}\frac{1}{\sigma^2}(\mathbf{y} - \boldsymbol\tau)'(\mathbf{y} - \boldsymbol\tau)\right\}.
\end{align}
\]</span></p>
</section>
<section id="prior-distributions" class="level2">
<h2 class="anchored" data-anchor-id="prior-distributions">Prior distributions</h2>
<p>The state equation for <span class="math inline">\(\boldsymbol\tau\)</span> can be rewritten as follows: <span class="math display">\[
\begin{gather}
\boldsymbol\tau = \mathbf{H}^{-1} \mathbf{i} \tau_0+\mathbf{H}^{-1}\boldsymbol\eta \\
\boldsymbol\eta \sim \mathcal{N}(\mathbf{0}_T, \sigma_\eta^2 \mathbf{I}_T) \\
\mathbf{H}^{-1} \boldsymbol\eta \sim \mathcal{N}(\mathbf{0}_T, \sigma_\eta^2\left(\mathbf{H}^{\prime} \mathbf{H}\right)^{-1})
\end{gather}
\]</span> Using the state equation for <span class="math inline">\(\boldsymbol\tau\)</span> above, we can derive the prior distribution of <span class="math inline">\(\boldsymbol\tau\)</span> as: <span class="math display">\[
\begin{align}
\boldsymbol\tau | \tau_0, \sigma_\eta^2 &amp;\sim \mathcal{N}_T(\mathbf{H}^{-1} \mathbf{i} \tau_0, \sigma_\eta^2(\mathbf{H}^{\prime} \mathbf{H})^{-1})
\\ &amp;\propto \exp \left\{-\frac{1}{2} \frac{1}{\sigma_\eta^2}\left(\boldsymbol\tau-\mathbf{H}^{-1} \mathbf{i} \tau_0\right)^{\prime}\left(\mathbf{H}^{\prime} \mathbf{H}\right)\left(\boldsymbol\tau-\mathbf{H}^{-1} \mathbf{i} \tau_0\right)\right\}
\end{align}
\]</span> Next, the prior distribution of <span class="math inline">\(\tau_0\)</span> is defined as uni-variate normal: <span class="math display">\[
\begin{align}
\tau_0 &amp;\sim \mathcal{N}(\underline{\tau_0}, \underline{V_{\tau_{0}}})
\\ &amp;\propto \exp \left\{-\frac{1}{2}(\tau_0-\underline{\tau_0})^{\prime} \underline{V_{\tau_{0}}}^{-1}(\tau_0-\underline{\tau_0})\right\}
\end{align}
\]</span> and the prior distribution of <span class="math inline">\(\sigma_\eta^2\)</span> is inverted gamma 2: <span class="math display">\[
\begin{align}
\sigma_\eta^2 &amp;\sim \mathcal{IG}2(\underline{s_\eta}, \underline{v_\eta}) \\
&amp;\propto (\sigma_\eta^2)^{-\frac{\underline{v}+2}{2}} \exp \left\{-\frac{1}{2} \frac{s}{\sigma_\eta^2}\right\}
\end{align}
\]</span></p>
<p>The prior distribution of <span class="math inline">\(\sigma^2\)</span> is the following: <span class="math display">\[
\begin{align}
\sigma^2 &amp;\sim \mathcal{IG}2(\underline{s}, \underline{v}) \\
&amp;\propto (\sigma^2)^{-\frac{\underline{v}+2}{2}} \exp \left\{-\frac{1}{2} \frac{s}{\sigma^2}\right\}
\end{align}
\]</span></p>
<p>The Joint prior distribution of the parameters of the model <span class="math inline">\(\boldsymbol\tau\)</span>, <span class="math inline">\(\tau_0\)</span>, <span class="math inline">\(\sigma^2_{\eta}\)</span>, and <span class="math inline">\(\sigma^2\)</span> is then given by: <span class="math display">\[
\begin{aligned}
p(\boldsymbol\tau,\tau_{0},\sigma_{\eta}^{2},\sigma^{2}) = p(\boldsymbol\tau|\tau_{0},\sigma_{\eta}^{2}) \space p(\tau_{0}) \space p(\sigma_{\eta}^{2}) \space p(\sigma^{2})
\end{aligned}
\]</span> where the individual distributions on the RHS are as specified above.</p>
<p>Finally, given that <span class="math inline">\(\boldsymbol\epsilon\)</span> follows normal distribution, <span class="math display">\[
\begin{align}
\boldsymbol\epsilon\mid\sigma^2 &amp;\sim \mathcal{N}(\mathbf{0}_T, \sigma^2 \mathbf{I}_T)
\end{align}
\]</span> the prior distribution of <span class="math inline">\(\boldsymbol\epsilon\)</span> given <span class="math inline">\(\sigma^2\)</span> is proportional to: <span class="math display">\[
\begin{align}
\boldsymbol\epsilon | \sigma^2 &amp;\propto \exp \left\{-\frac{1}{2} \frac{1}{\sigma^2} \boldsymbol\epsilon^{\prime}\boldsymbol\epsilon\right\}
\end{align}
\]</span></p>
</section>
</section>
<section id="bayesian-estimation" class="level1">
<h1>Bayesian estimation</h1>
<section id="derivation-of-full-conditional-posterior-distributions" class="level2">
<h2 class="anchored" data-anchor-id="derivation-of-full-conditional-posterior-distributions">Derivation of full conditional posterior distributions</h2>
<p>Full conditional posterior distribution could be estimated basing on Bayes’ theorem and priors shown above. Therefore, the full conditional posterior distribution is proportional to the product of likelihood functions and priors. <span class="math display">\[
\begin{aligned}
p(\tau,\tau_{0},\sigma^{2},\sigma_{\eta}^{2}|\mathbf{y}) &amp; \propto p(\mathbf{y}|\tau,\tau_{0},\sigma^{2},\sigma_{\eta}^{2}) \space p(\tau,\tau_{0},\sigma^{2},\sigma_{\eta}^{2})
\end{aligned}
\]</span> The joint prior is as specified in the section above.</p>
<p>Two Conditional likelihood functions to derive the <strong>full Conditional posterior distribution</strong> of <span class="math inline">\(\tau,\tau_{0},\sigma^{2},\sigma_{\eta}^{2}\)</span> is as follows: <span class="math display">\[
\begin{align}
L(\boldsymbol\tau,\sigma^{2}|\mathbf{y},\tau_{0},\sigma_{\eta}^{2}) \propto \left( \sigma^{2} \right)^{-\frac{T}{2}} \times\exp\left\{ -\frac{1}{2}\sigma^{-2}\left( \mathbf{y}-\boldsymbol\tau \right)'\left( \mathbf{y}-\boldsymbol\tau \right) \right\}
\end{align}
\]</span> and <span class="math display">\[
\begin{align}
L(\tau_{0},\sigma_{\eta}^{2}|\mathbf{y},\boldsymbol\tau,\sigma^{2}) \propto \left( \sigma_{\eta}^{2} \right)^{-\frac{T}{2}} \times\exp\left\{-\frac{1}{2}\sigma_{\eta}^{-2}\left(\mathbf{H}\boldsymbol\tau -\mathbf{i}\tau_{0}\right)'\left(\mathbf{H}\boldsymbol\tau-\mathbf{i}\tau_{0}\right)\right\}
\end{align}
\]</span></p>
<p>The full Conditional posterior distribution of <span class="math inline">\(\boldsymbol\tau\)</span> is derived as follows: <span class="math display">\[
\begin{align}
P(\boldsymbol\tau|\mathbf{y},\tau_{0},\sigma^{2},\sigma_{\eta}^{2})&amp;\propto L(\boldsymbol\tau,\sigma^{2}|\mathbf{y},\tau_{0},\sigma_{\eta}^{2}) \space P(\boldsymbol\tau|\tau_{0},\sigma_{\eta}^{2})\\
\\&amp;\propto \exp\left\{ -\frac{1}{2}\sigma^{-2}\left( \mathbf{y}-\boldsymbol\tau \right)'\left( \mathbf{y}-\boldsymbol\tau \right) \right\}\\
&amp;\qquad\times \exp\left\{ -\frac{1}{2}\sigma_{\eta}^{-2}\left(\boldsymbol\tau-\mathbf{H}^{-1} \mathbf{i}\tau_{0}\right)'\mathbf{H}'\mathbf{H}\left( \boldsymbol\tau-\mathbf{H}^{-1} \mathbf{i}\tau_{0} \right) \right\}
\end{align}
\]</span> that after completing th squares results in a multivariate normal full conditional posterior distribution: <span class="math display">\[
\begin{align}
P(\boldsymbol\tau &amp;|\mathbf{y},\tau_{0},\sigma^{2},\sigma_{\eta}^{2}) \sim \mathcal{N}(\overline{\boldsymbol\tau},\overline{V_{\boldsymbol\tau}}) \\
\\ \overline{V_{\boldsymbol\tau}} &amp;= \left[ \sigma^{-2}\mathbf{I}_T +\sigma_{\eta}^{-2}\mathbf{H}'\mathbf{H}\right]^{-1}\\
\overline{\boldsymbol\tau} &amp;= \overline{V_{\tau}}\left[\sigma^{-2}\mathbf{y} + \sigma_{\eta}^{-2}\mathbf{H}'\mathbf{i}\tau_{0} \right]
\end{align}
\]</span> The full conditional posterior distribution of <span class="math inline">\(\tau_{0}\)</span> is the following: <span class="math display">\[
\begin{align}
P(\tau_{0}|\mathbf{y},\boldsymbol\tau,\sigma^{2},\sigma_{\eta}^{2}) &amp;\propto L(\tau_{0}|\mathbf{y},\boldsymbol\tau,\sigma^{2},\sigma_{\eta}^{2}) \space P(\tau_{0}|\sigma_{\eta}^{2}) \\
\\ &amp;\propto \exp\left\{ -\frac{1}{2}\sigma_{\eta}^{-2}\left(\mathbf{H}\boldsymbol\tau -\mathbf{i}\tau_{0}\right)'\left(\mathbf{H}\boldsymbol\tau-\mathbf{i}\tau_{0}\right)\right\}\\
&amp;\times \exp\left\{ -\frac{1}{2}\left(\tau_{0}-  \underline{\tau_0}\right)'\underline{V_{\tau_{0}}}^{-1}\left(\tau_{0}-  \underline{\tau_0}\right) \right\}
\end{align}
\]</span> and is given by a uni-variate normal distribution: <span class="math display">\[
\begin{align}
P(\tau_{0} &amp;|\mathbf{y},\boldsymbol\tau,\sigma^{2},\sigma_{\eta}^{2}) \sim N(\overline{\tau_{0}},\overline{V_{\tau_{0}}}) \\
\\ \overline{V_{\tau_{0}}}&amp;=\left[ \sigma_{\eta}^{-2}\mathbf{i}'\mathbf{i} +\underline{V_{\tau_{0}}}^{-1}\right]^{-1} =\left[ \sigma_{\eta}^{-2} +\underline{V_{\tau_{0}}}^{-1}\right]^{-1} \\
\overline{\tau_{0}}&amp;=\overline{V_{\tau_{0}}}\left[ \sigma_{\eta}^{-2} \mathbf{i}'\mathbf{H}\boldsymbol\tau +\underline{V_{\tau_{0}}}^{-1}\underline{\tau_{0}}\right]\\
&amp;= \overline{V_{\tau_{0}}}\left[ \sigma_{\eta}^{-2} \tau_1 +\underline{V_{\tau_{0}}}^{-1}\underline{\tau_{0}}\right]
\end{align}
\]</span> The full conditional posterior distribution of <span class="math inline">\(\sigma_{\eta}^{2}\)</span> is derived as: <span class="math display">\[
\begin{align}
P(\sigma_{\eta}^{2}|\mathbf{y},\boldsymbol\tau,\tau_{0},\sigma^{2}) &amp;\propto L(\sigma_{\eta}^{2}|\mathbf{y},\boldsymbol\tau,\tau_{0},\sigma^{2}) \space P(\sigma_{\eta}^{2}) \\
\\ &amp;\propto \left( \sigma_{\eta}^{2} \right)^{-\frac{T}{2}} \exp\left\{ -\frac{1}{2}\sigma_{\eta}^{-2}\left(\mathbf{H}\boldsymbol\tau -\mathbf{i}\tau_{0}\right)'\left(\mathbf{H}\boldsymbol\tau -\mathbf{i}\tau_{0}\right)\right\}
\\ &amp;\times \left( \sigma_{\eta}^{2} \right)^{-\frac{\underline{\upsilon}+2}{2}} \exp\left\{ -\frac{1}{2}\frac{\underline{s}}{\sigma_{\eta}^{2}}\right\}
\end{align}
\]</span> where <span class="math display">\[
\begin{align}
P(\sigma_{\eta}^{2}&amp;|\mathbf{y},\boldsymbol\tau,\tau_{0},\sigma^{2}) \sim \mathcal{IG}2(\overline{s_{\eta}},\overline{\upsilon_{\eta}}) \\
\\ \overline{s_{\eta}}&amp;=\underline{s} + \left(\mathbf{H}\boldsymbol\tau -\mathbf{i}\tau_{0}\right)'\left(\mathbf{H}\boldsymbol\tau -\mathbf{i}\tau_{0}\right) \\
\overline{\upsilon_{\eta}}&amp;= \underline{\upsilon}+T
\end{align}
\]</span> Finally, the full conditional posterior distribution of <span class="math inline">\(\sigma^{2}\)</span> is the following: <span class="math display">\[
\begin{align}
P(\sigma^{2}|\mathbf{y},\boldsymbol\tau,\tau_{0},\sigma_{\eta}^{2})&amp;=L(\sigma^{2}|\mathbf{y},\boldsymbol\tau,\tau_{0},\sigma_{\eta}^{2}) \space P(\sigma^{2}) \\
\\ &amp;\propto \left( \sigma^{2} \right)^{-\frac{T}{2}} \exp\left\{ -\frac{1}{2}\sigma^{-2}\left(\mathbf{y}-\boldsymbol\tau\right)'\left(\mathbf{y}-\boldsymbol\tau\right)\right\}
\\ &amp;\times \left( \sigma^{2} \right)^{-\frac{\underline{\upsilon}+2}{2}} \exp\left\{ -\frac{1}{2}\frac{\underline{s}}{\sigma^{2}}\right\}
\end{align}
\]</span> where <span class="math display">\[
\begin{align}
P(\sigma^{2}|&amp;\mathbf{y},\boldsymbol\tau,\tau_{0},\sigma_{\eta}^{2}) \sim \mathcal{IG}2(\overline{s},\overline{\upsilon}) \\
\\ \overline{s}&amp;=\underline{s} + \left(\mathbf{y}-\boldsymbol\tau\right)'\left(\mathbf{y}-\boldsymbol\tau\right) \\
\overline{\upsilon}&amp;= \underline{\upsilon}+T
\end{align}
\]</span></p>
</section>
<section id="gibbs-sampler" class="level2">
<h2 class="anchored" data-anchor-id="gibbs-sampler">Gibbs sampler</h2>
<p>A <strong>Gibbs Sampler</strong> can be applied using the following steps:</p>
<p>At each iteration <span class="math inline">\(s\)</span> where <span class="math inline">\(s\)</span> goes from 1 to <span class="math inline">\(S\)</span>,</p>
<p>&nbsp;&nbsp;&nbsp;Step 1. Draw <span class="math inline">\(\tau_0^{(s)}\)</span> from the <span class="math inline">\(N({\tau_{0}}, {V_{\tau_{0}}})\)</span> distribution and collect <span class="math inline">\(\tau_0\)</span>.<br>
&nbsp;&nbsp;&nbsp;Step 2. Draw <span class="math inline">\({\sigma^2_{\eta}}^{(s)}\)</span> from the <span class="math inline">\(\mathcal{IG}2({S_\eta}, {v_\eta})\)</span> distribution and collect <span class="math inline">\(\sigma_\eta^2\)</span>.<br>
&nbsp;&nbsp;&nbsp;Step 3. Draw <span class="math inline">\({\sigma^2}^{(s)}\)</span> from the <span class="math inline">\(\mathcal{IG}2(S, v)\)</span> distribution and collect <span class="math inline">\(\sigma^2\)</span>.<br>
&nbsp;&nbsp;&nbsp;Step 4. Draw <span class="math inline">\(\boldsymbol\tau^{(s)}\)</span> from the <span class="math inline">\(\mathcal{N}({\boldsymbol\tau},{V_{\tau}})\)</span> distribution and collect <span class="math inline">\(\boldsymbol\tau\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gibbs sampler for a simple UC model using simulation smoother</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">############################################################</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>UC.Gibbs.sampler    <span class="ot">=</span> <span class="cf">function</span>(S, starting.values, priors){</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize the data </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  aux     <span class="ot">=</span> starting.values</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  T       <span class="ot">=</span> <span class="fu">nrow</span>(aux<span class="sc">$</span>Y)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  i_matrix <span class="ot">&lt;-</span> <span class="fu">diag</span>(T)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, T, <span class="dv">1</span>)  </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  i[<span class="dv">1</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Posteriors list</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  posteriors    <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau     =</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,T,S),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau_0   =</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="dv">1</span>,S),</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma   =</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="dv">2</span>,S)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  HH <span class="ot">=</span> <span class="fu">crossprod</span>(priors<span class="sc">$</span>H)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S){</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sampling tau_0</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    tau_0.v.inv    <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>priors<span class="sc">$</span>tau_0.v</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    V.tau_0.bar    <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>((<span class="dv">1</span><span class="sc">/</span>aux<span class="sc">$</span>sigma[<span class="dv">1</span>]) <span class="sc">+</span> tau_0.v.inv )</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    tau_0.bar      <span class="ot">=</span> V.tau_0.bar <span class="sc">%*%</span> ( (<span class="dv">1</span><span class="sc">/</span>aux<span class="sc">$</span>sigma[<span class="dv">1</span>])<span class="sc">*</span>aux<span class="sc">$</span>tau[<span class="dv">1</span>] <span class="sc">+</span> tau_0.v.inv<span class="sc">*</span>priors<span class="sc">$</span>tau_0 )</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    tau_0.draw     <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fu">as.vector</span>(tau_0.bar),<span class="fu">sqrt</span>(V.tau_0.bar))</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    aux<span class="sc">$</span>tau_0      <span class="ot">=</span> tau_0.draw</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sampling sigma</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sigma of tau (sigma_eta)</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    sigma.eta.s   <span class="ot">=</span> <span class="fu">as.numeric</span>(priors<span class="sc">$</span>sigma.s <span class="sc">+</span> <span class="fu">crossprod</span>(priors<span class="sc">$</span>H<span class="sc">%*%</span>aux<span class="sc">$</span>tau <span class="sc">-</span> i<span class="sc">%*%</span>priors<span class="sc">$</span>tau_0))</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    sigma.eta.nu  <span class="ot">=</span> priors<span class="sc">$</span>sigma.nu <span class="sc">+</span> T</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    sigma.eta.draw <span class="ot">=</span> sigma.eta.s<span class="sc">/</span><span class="fu">rchisq</span>(<span class="dv">1</span>,sigma.eta.nu)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sigma of errors (sigma)</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    sigma.e.s     <span class="ot">=</span> <span class="fu">as.numeric</span>(priors<span class="sc">$</span>sigma.s <span class="sc">+</span> <span class="fu">crossprod</span>(aux<span class="sc">$</span>Y <span class="sc">-</span> aux<span class="sc">$</span>tau))</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    sigma.e.nu    <span class="ot">=</span> priors<span class="sc">$</span>sigma.nu <span class="sc">+</span> T</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    sigma.e.draw  <span class="ot">=</span> sigma.e.s<span class="sc">/</span><span class="fu">rchisq</span>(<span class="dv">1</span>,sigma.e.nu)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    aux<span class="sc">$</span>sigma     <span class="ot">=</span> <span class="fu">c</span>(sigma.eta.draw,sigma.e.draw)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sampling tau</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    V.tau.inv     <span class="ot">=</span> (<span class="dv">1</span><span class="sc">/</span>aux<span class="sc">$</span>sigma[<span class="dv">2</span>])<span class="sc">*</span>i_matrix <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span>aux<span class="sc">$</span>sigma[<span class="dv">1</span>])<span class="sc">*</span>HH</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    V.tau.inv     <span class="ot">=</span> <span class="fl">0.5</span><span class="sc">*</span>(V.tau.inv <span class="sc">+</span> <span class="fu">t</span>(V.tau.inv))</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    b.tau         <span class="ot">=</span> (<span class="dv">1</span><span class="sc">/</span>aux<span class="sc">$</span>sigma[<span class="dv">2</span>])<span class="sc">*</span>aux<span class="sc">$</span>Y <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span>aux<span class="sc">$</span>sigma[<span class="dv">1</span>])<span class="sc">*</span><span class="fu">t</span>(priors<span class="sc">$</span>H)<span class="sc">%*%</span>i<span class="sc">*</span>priors<span class="sc">$</span>tau_0</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    precision.L   <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">bandchol</span>(V.tau.inv))</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    epsilon       <span class="ot">=</span> <span class="fu">rnorm</span>(T)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    b.tau.tmp     <span class="ot">=</span> <span class="fu">forwardsolve</span>(precision.L, b.tau)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    tau.draw      <span class="ot">=</span> <span class="fu">backsolve</span>(<span class="fu">t</span>(precision.L), b.tau.tmp <span class="sc">+</span> epsilon)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    aux<span class="sc">$</span>tau       <span class="ot">=</span> tau.draw</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    posteriors<span class="sc">$</span>tau[,s]     <span class="ot">=</span> aux<span class="sc">$</span>tau</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    posteriors<span class="sc">$</span>tau_0[,s]   <span class="ot">=</span> aux<span class="sc">$</span>tau_0</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    posteriors<span class="sc">$</span>sigma[,s]   <span class="ot">=</span> aux<span class="sc">$</span>sigma</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (s<span class="sc">%%</span><span class="dv">1000</span><span class="sc">==</span><span class="dv">0</span>){<span class="fu">cat</span>(<span class="st">" "</span>,s)}</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  output      <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">posterior =</span> posteriors,</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">last.draw =</span> aux</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simulation-smoother-and-precision-sampler" class="level2">
<h2 class="anchored" data-anchor-id="simulation-smoother-and-precision-sampler">Simulation smoother and precision sampler</h2>
<p>Simulation Smoother is used when drawing state variables in discrete time state-space models from their conditional distribution. This tool greatly improved Bayesian estimation process in conditional linear Gaussian state-space models. The benefit of using this method comes from the fact that one does not rely on an iterative procedure of forward filtering and backward smoothing. Instead, this step is performed all without a loop.</p>
<p>Consider sampling random draws from a multivariate normal distribution presented as:</p>
<p><span class="math display">\[
N_{T}(D^{-1}b,D^{-1})
\]</span></p>
<p>where: <span class="math inline">\(D\)</span> is a <span class="math inline">\(T \times T\)</span> precision matrix of covariance matrix <span class="math inline">\(\Sigma\)</span>, such that <span class="math inline">\(D = \Sigma^{-1}\)</span>, and <span class="math inline">\(b\)</span> is an <span class="math inline">\(T\times1\)</span> restriction vector to specify the <strong>Mean</strong> of multivariate normal distribution, where <span class="math inline">\(M = \Sigma b\)</span>.</p>
<p>This parameterisation is particularly useful as matrices <span class="math inline">\(D\)</span> and <span class="math inline">\(b\)</span> can be computed easily. Additionally, matrix <span class="math inline">\(D\)</span> that in the simulation smoother for state-space models is a band matrix and often a tridiagonal matrix. The latter case arises for a one-lag autoregressive state-space process. Therefore, the computation time is much shorter if dedicated numerical algorithms are employed. For tridiagnal matrix <span class="math inline">\(D\)</span> in state space model, let <span class="math inline">\(L\)</span> be a lower-triangular matrix obtained by Cholesky decomposition, where <span class="math inline">\(D = LL'\)</span> (Assume that <span class="math inline">\(L^{-1}\)</span> can be compute efficiently).</p>
<p>Therefore, the mean of the normal distribution above can be presented as:</p>
<p><span class="math display">\[
M = D^{-1}b = (LL')^{-1}b = L'^{-1}L^{-1}b
\]</span></p>
<p>Let a <span class="math inline">\(T \times 1\)</span> vector x contain <span class="math inline">\(T\)</span> independent random draws from a standard normal distribution, <span class="math inline">\(X\sim N_{T} ( 0_{T}, I_{T})\)</span>. Therefore, the target distribution, <span class="math inline">\(Y\sim N_{T}(D^{-1}b,D^{-1})\)</span>, can be treated as:</p>
<p><span class="math display">\[
Y = D^{-1}b + \sqrt{D^{-1}} X = L'^{-1}L^{-1}b + L'^{-1} X
\]</span></p>
<p>Therefor a draw form the target distribution, <span class="math inline">\(N_{T}(D^{-1}b,D^{-1})\)</span>, it’s equivalent to:</p>
<p><span class="math display">\[
L'^{-1}L^{-1}b + L'^{-1}x = L'^{-1}(L^{-1}b + x)
\]</span></p>
<p>Following algorithm base on solving a linear equation by back-substitution rather than computation of the inverse matrix:</p>
<ol type="1">
<li><strong>Compute</strong> <span class="math inline">\(L = chol(D)\)</span> such that <span class="math inline">\(D = LL'\)</span></li>
<li><strong>Sample</strong> <span class="math inline">\(x\sim N_{T} ( 0_{T}, I_{T})\)</span></li>
<li><strong>Compute</strong> a draw from the distribution via the affine transformation: <span class="math inline">\(L '\smallsetminus (L \smallsetminus b + x)\)</span></li>
</ol>
<p>Note: Let <span class="math inline">\(L \smallsetminus b\)</span> denote the unique solution to the triangular system Lx = b obtained by forward (backward) substitution, that is, <span class="math inline">\(L \smallsetminus b = L^{−1}b\)</span>.</p>
<section id="simulation-smoother-algorithm-in-r" class="level3">
<h3 class="anchored" data-anchor-id="simulation-smoother-algorithm-in-r">Simulation smoother algorithm in R</h3>
<p>Compare the computational speed of generating random numbers from a multivariate normal distribution using dedicated numerical algorithms in function <code>rmvnorm.tridiag.precision</code> and function <code>solve</code> for the matrix inversion ignoring the tridiagonality of the precision matrix in function <code>rmvnorm.usual</code>:</p>
<div class="cell" data-hash="index_cache/html/Simulation smoother in R comparison_6c3ec8e9c6cd1bd2476076d12d37efce">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>rmvnorm.tridiag.precision <span class="ot">=</span> <span class="cf">function</span>(n, D, b){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  N           <span class="ot">=</span> <span class="fu">dim</span>(D)[<span class="dv">1</span>]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  lead.diag   <span class="ot">=</span> <span class="fu">diag</span>(D)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  sub.diag    <span class="ot">=</span> <span class="fu">sdiag</span>(D, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  D.chol      <span class="ot">=</span> <span class="fu">trichol</span>(<span class="at">ld =</span> lead.diag, <span class="at">sd=</span>sub.diag)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  D.L         <span class="ot">=</span> <span class="fu">diag</span>(D.chol<span class="sc">$</span>ld)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sdiag</span>(D.L,<span class="sc">-</span><span class="dv">1</span>) <span class="ot">=</span> D.chol<span class="sc">$</span>sd</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  x           <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n<span class="sc">*</span>N), <span class="at">ncol=</span>n)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  a           <span class="ot">=</span> <span class="fu">forwardsolve</span>(D.L, b)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  draw        <span class="ot">=</span> <span class="fu">backsolve</span>(<span class="fu">t</span>(D.L), <span class="fu">matrix</span>(<span class="fu">rep</span>(a,n), <span class="at">ncol=</span>n) <span class="sc">+</span> x)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(draw)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Function of normal method</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>rmvnorm.usual <span class="ot">=</span> <span class="cf">function</span>(n, D, b){</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  N           <span class="ot">=</span> <span class="fu">dim</span>(D)[<span class="dv">1</span>]</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  D.chol      <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">chol</span>(D))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  variance.chol <span class="ot">=</span> <span class="fu">solve</span>(D.chol)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  x           <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n<span class="sc">*</span>N), <span class="at">ncol=</span>n)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  draw        <span class="ot">=</span> <span class="fu">t</span>(variance.chol) <span class="sc">%*%</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>           (<span class="fu">matrix</span>(<span class="fu">rep</span>(variance.chol<span class="sc">%*%</span>b,n), <span class="at">ncol=</span>n) <span class="sc">+</span> x)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(draw)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparison</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>T <span class="ot">=</span> <span class="dv">300</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>md <span class="ot">=</span> <span class="fu">rgamma</span>(T, <span class="at">shape=</span><span class="dv">10</span>, <span class="at">scale=</span><span class="dv">10</span>) </span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>od <span class="ot">=</span> <span class="fu">rgamma</span>(T<span class="dv">-1</span>, <span class="at">shape=</span><span class="dv">10</span>, <span class="at">scale=</span><span class="dv">1</span>) </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>D <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">diag</span>(md)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="fu">sdiag</span>(D, <span class="dv">1</span>) <span class="ot">=</span> <span class="sc">-</span>od</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="fu">sdiag</span>(D, <span class="sc">-</span><span class="dv">1</span>) <span class="ot">=</span> <span class="sc">-</span>od</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fu">as.matrix</span>(<span class="fu">rnorm</span>(T))</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="fu">microbenchmark</span>(</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">trid  =</span> <span class="fu">rmvnorm.tridiag.precision</span>(<span class="at">n=</span><span class="dv">100</span>, <span class="at">D=</span>D, <span class="at">b=</span>b),</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">usual =</span> <span class="fu">rmvnorm.usual</span>(<span class="at">n=</span><span class="dv">100</span>, <span class="at">D=</span>D, <span class="at">b=</span>b),</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">check =</span> <span class="st">"equal"</span>, <span class="at">setup=</span><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in microbenchmark(trid = rmvnorm.tridiag.precision(n = 100, D = D, :
less accurate nanosecond times to avoid potential integer overflows</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Unit: milliseconds
  expr       min        lq      mean    median        uq      max neval
  trid  3.099969  3.207758  4.792219  3.252038  3.286868 53.63788   100
 usual 22.485384 22.684173 23.063725 22.761212 22.950755 25.30709   100</code></pre>
</div>
</div>
<p>Therefore, we could clearly see that the computational time drops substatially due to simulation smoothing method.</p>
</section>
</section>
<section id="analytical-solution-for-a-joint-posterior-distribution" class="level2">
<h2 class="anchored" data-anchor-id="analytical-solution-for-a-joint-posterior-distribution">Analytical solution for a joint posterior distribution</h2>
<p>Consider a simplified model with a fixed signal-to-noise ratio <span class="math inline">\(c\)</span> given by</p>
<p><span class="math display">\[\begin{align}
\text{measurement equation} &amp;&amp; y &amp;= \tau + \epsilon\\
\text{state equation} &amp;&amp; \mathbf{H}\tau &amp;= \eta\\
\text{error term} &amp;&amp; \epsilon\mid\tau &amp;\sim \mathcal{N}_T(\mathbf{0}_T, \sigma^2\mathbf{I}_T)\\
\text{innovation} &amp;&amp; \eta &amp;\sim \mathcal{N}_T(\mathbf{0}_T, c\sigma^2\mathbf{I}_T)
\end{align}\]</span> where <span class="math inline">\(c\)</span> is a constant, and <span class="math inline">\(\tau_0 = 0\)</span>.</p>
<p>In this model the state equation for <span class="math inline">\(\tau\)</span> is given by a Gaussian random ralk presented as:</p>
<p><span class="math display">\[\begin{pmatrix}
1 &amp; 0 &amp; \cdots &amp; 0 \\
-1 &amp; 1 &amp; \cdots &amp; 0 \\
\vdots &amp; \ddots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; -1 &amp; 1
\end{pmatrix} \begin{pmatrix} \tau_1 \\ \tau_2 \\ \vdots \\ \tau_T \end{pmatrix}  = \begin{pmatrix} \tau_1 \\ \tau_2-\tau_1 \\ \vdots \\ \tau_T - \tau_{T-1} \end{pmatrix} = \eta\]</span></p>
<p>The parameters to be estimated are: <span class="math inline">\(\mathbf{\color{purple}{\tau, \sigma^2}}\)</span></p>
<section id="prior-distributions-1" class="level3">
<h3 class="anchored" data-anchor-id="prior-distributions-1">Prior distributions</h3>
<section id="prior-distribution-for-tau" class="level4">
<h4 class="anchored" data-anchor-id="prior-distribution-for-tau">Prior distribution for <span class="math inline">\(\tau\)</span></h4>
<p>Rewrite the state equation as <span class="math display">\[\tau =  H^{-1}\eta\]</span> Then the prior distribution of <span class="math inline">\(\tau\)</span> is formed using <span class="math display">\[\mathbf{\color{purple}{\eta \sim \mathcal{N}(0_T, c \sigma^2 I_T) \implies H^{-1}\eta \sim \mathcal{N}(0_T, c\sigma^2(H^T H)^{-1})}}\]</span> since <span class="math inline">\(Var(H^{-1}\eta) = H^{-1}Var(\eta)(H^{-1})^T =c\sigma^2(H^TH)^{-1}\)</span></p>
<p>Then, the prior distribution of <span class="math inline">\(\tau|\sigma^2\)</span> is <span class="math display">\[\tau|\sigma^2 \sim \mathcal{N}(0_T, c\sigma^2(H^TH)^{-1}) \\ \propto (c\sigma^2)^{-\frac{T}{2}}exp\left(-\frac{\tau^TH^T H\tau}{2c\sigma^2}\right)
\]</span></p>
</section>
<section id="prior-assumptions-for-sigma2" class="level4">
<h4 class="anchored" data-anchor-id="prior-assumptions-for-sigma2">Prior assumptions for <span class="math inline">\(\sigma^2\)</span></h4>
<p><span class="math display">\[\sigma^2 \sim \mathcal{IG2}(s_{prior}, \nu_{prior}) \propto (\sigma^2)^\frac{-\nu_{prior}+2}{2}exp\left(-\frac{s_{prior}}{2\sigma^2}\right)\]</span></p>
</section>
</section>
<section id="the-joint-posterior-distribution" class="level3">
<h3 class="anchored" data-anchor-id="the-joint-posterior-distribution">The Joint Posterior Distribution</h3>
<p>The likelihood function is constructed using the the measurement equation: <span class="math display">\[y = \tau + \epsilon\]</span> and the distributional assumption on its error term <span class="math display">\[\epsilon \sim \mathcal{N}(0_T, \sigma^2I_T)\]</span> which results in the likelihood function: <span class="math display">\[y|\tau, \sigma^2 \sim \mathcal{N}(\tau, \sigma^2I_T)\propto (\sigma^2)^{-\frac{T}{2}}exp\left(-\frac{1}{2\sigma^2}(y-\tau)^T(y-\tau)\right)\]</span></p>
<p>The likelihood is combined with the joint prior distribution of <span class="math inline">\(\tau\)</span> and <span class="math inline">\(\sigma^2\)</span> to derive the joint posterior distribution of <span class="math inline">\(\tau\)</span> and <span class="math inline">\(\sigma^2\)</span>. It is derived as follows:</p>
<p><span class="math display">\[
p(\tau, \sigma^2 |y) = \frac{p(\tau, \sigma^2, y)}{p(y)} \propto p(\tau, \sigma^2, y) = p(y | \tau, \sigma^2)p(\tau, \sigma^2) =p(y | \tau, \sigma^2)p(\tau|\sigma^2)p(\sigma^2)
\]</span></p>
<p>This expression is proportional to <span class="math display">\[\begin{align}
&amp;\propto (\sigma^2)^{-\frac{T}{2}}exp\left(-\frac{(y-\tau)^T(y-\tau)}{2\sigma^2}\right) \times
(\sigma^2)^{-\frac{T}{2}}\exp\left(-\frac{\tau^TH^T H\tau}{2c\sigma^2}\right)\\
&amp;\qquad\times(\sigma^2)^{-\frac{\nu_{prior}+2}{2}} \exp(-\frac{s_{prior}}{2\sigma^2})\\
&amp;\propto \exp(-\frac{y^Ty - 2\tau^T y + \tau^T\tau + c^{-1}\tau^TH^T H\tau}{2\sigma^2})\\ &amp;\qquad\times \exp(-\frac{s_{prior}}{2\sigma^2})\times(\sigma^2)^{-\frac{2T+\nu_{prior}+2}{2}}\\
&amp;= \exp(-\frac{\tau^T(c^{-1}H^T H + I_T)\tau - 2\tau^Ty}{2\sigma^2})\\
&amp;\qquad\times\exp(-\frac{y^Ty + s_{prior}}{2\sigma^2})\times(\sigma^2)^{-\frac{2T+\nu_{prior}+2}{2}}
\end{align}\]</span></p>
<p>Let <span class="math inline">\(\bar{\Sigma} = (c^{-1}H^T H + I_T)^{-1}\)</span>, then <span class="math display">\[\begin{align}
p(\tau, \sigma^2 |y) &amp;\propto \exp(-\frac{\tau^T\bar{\Sigma}^{-1}\tau - 2\tau^Ty + y^T\bar{\Sigma}y}{2\sigma^2})\exp(-\frac{y^Ty + s_{prior}-y^T\bar{\Sigma}y}{2\sigma^2})\\
&amp;\qquad\times(\sigma^2)^{-\frac{2T+\nu_{prior}+2}{2}}
\end{align}\]</span></p>
<p>In the expression above, we recognise the kernel of the <span class="math inline">\(T\)</span>-variate normal inverted gamma 2 distribution. Therefore, the joint posterior of the parameters of the model is given by: <span class="math display">\[\begin{align}
\tau, \Sigma |y &amp;\sim \mathcal{NIG2}(\bar{\tau}, \bar{\Sigma}, \bar{\nu}, \bar{s})\\[2ex]
\bar{\Sigma} &amp;= (c^{-1}H^T H + I_T)^{-1}\\
\bar{\tau} &amp;= \bar{\Sigma}y\\
\bar{\nu} &amp;= 2T+\nu_{prior}\\
\bar{s} &amp;= s_{prior}+y^Ty-y^T\bar{\Sigma}y
\end{align}\]</span></p>
<p>The function below implements the sampler from this joint distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>UC.local.tau.sigma.Gibbs.sampler    <span class="ot">=</span> <span class="cf">function</span>(S, starting.values, priors){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  aux     <span class="ot">=</span> starting.values</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  T       <span class="ot">=</span> <span class="fu">nrow</span>(aux<span class="sc">$</span>Y)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  posteriors    <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau     =</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,T,S),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma   =</span> <span class="fu">rep</span>(<span class="cn">NA</span>,S)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S){</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    V.tau.bar.inv <span class="ot">=</span> priors<span class="sc">$</span>c<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="fu">t</span>(aux<span class="sc">$</span>H)<span class="sc">%*%</span>aux<span class="sc">$</span>H <span class="sc">+</span> <span class="fu">diag</span>(T)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    V.tau.bar.inv <span class="ot">=</span> <span class="fl">0.5</span><span class="sc">*</span>(V.tau.bar.inv <span class="sc">+</span> <span class="fu">t</span>(V.tau.bar.inv))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sampling sigma</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    sigma.s   <span class="ot">=</span> <span class="fu">as.numeric</span>(priors<span class="sc">$</span>sigma.s <span class="sc">+</span> <span class="fu">t</span>(aux<span class="sc">$</span>Y)<span class="sc">%*%</span>aux<span class="sc">$</span>Y <span class="sc">-</span> <span class="fu">t</span>(aux<span class="sc">$</span>tau)<span class="sc">%*%</span>V.tau.bar.inv<span class="sc">%*%</span>aux<span class="sc">$</span>tau)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    sigma.nu  <span class="ot">=</span> priors<span class="sc">$</span>sigma.nu <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>T</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    sigma.draw<span class="ot">=</span> sigma.s<span class="sc">/</span><span class="fu">rchisq</span>(<span class="dv">1</span>,sigma.nu)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    aux<span class="sc">$</span>sigma     <span class="ot">=</span> sigma.draw</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sampling tau</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    b.tau         <span class="ot">=</span> aux<span class="sc">$</span>Y</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    precision.L   <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">bandchol</span>(V.tau.bar.inv))</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    epsilon       <span class="ot">=</span> <span class="fu">rnorm</span>(T)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    b.tau.tmp     <span class="ot">=</span> <span class="fu">forwardsolve</span>(precision.L, b.tau)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    tau.draw      <span class="ot">=</span> <span class="fu">backsolve</span>(<span class="fu">t</span>(precision.L), b.tau.tmp <span class="sc">+</span> epsilon)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    aux<span class="sc">$</span>tau       <span class="ot">=</span> tau.draw</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    posteriors<span class="sc">$</span>tau[,s]     <span class="ot">=</span> aux<span class="sc">$</span>tau</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    posteriors<span class="sc">$</span>sigma[,s]   <span class="ot">=</span> aux<span class="sc">$</span>sigma</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  output      <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">posterior =</span> posteriors,</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">last.draw =</span> aux</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="hierarchical-modeling" class="level1">
<h1>Hierarchical modeling</h1>
<section id="estimating-gamma-error-term-variance-prior-scale" class="level2">
<h2 class="anchored" data-anchor-id="estimating-gamma-error-term-variance-prior-scale">Estimating gamma error term variance prior scale</h2>
<p>To estimate the scale of inverted gamma 2 error term variance, we need to firstly put a prior on the prior scale of and present its full conditional posterior distribution.</p>
<p>The hirercical prior structure is below:</p>
<span class="math display">\[\begin{align*}
\sigma^2 \mid s &amp;\sim \text{IG2}(s, \nu) \\
s &amp;\sim \mathcal{G}(s_s, a)
\end{align*}\]</span>
<p>The full conditional posterior distribution of the prior scale <span class="math inline">\(s\)</span> is based on the prior <span class="math inline">\(p(\sigma^2 \mid s)\)</span>: <span class="math display">\[\begin{align}
p(\sigma^2 \mid s) \propto s^{\frac{\nu}{2}}(\sigma^2)^{-\frac{\nu+2}{2}} \exp \left( -\frac{1}{2}\frac{s}{\sigma^2} \right)
\end{align}\]</span> and that for <span class="math inline">\(s\)</span>: <span class="math display">\[\begin{align}
s \sim \mathcal{G}(s_s, a) \propto s^{a-1} \exp(-\frac{s}{s_s})
\end{align}\]</span> which results in the following full conditional posterior distribution: <span class="math display">\[\begin{align}
p(s \mid \mathbf{y}, \mathbf{\tau}, \sigma^2) &amp;= \mathcal{G}(\bar{s}_s,\bar{a})\\
\bar{s}_s &amp;= \left(s_s^{-1} + (2\sigma^2)^{-1}\right)^{-1}\\
\bar{a} &amp;= a + \frac{\nu}{2}
\end{align}\]</span></p>
<p>The code below implements the sampler from the full conditional posterior for <span class="math inline">\(s\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sample_s <span class="ot">=</span> <span class="cf">function</span>(sigma2, s_s, a, nu) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  shape_s <span class="ot">=</span> a <span class="sc">+</span> nu<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  scale_s <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>((<span class="dv">1</span><span class="sc">/</span>s_s) <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>sigma2))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="dv">1</span>, <span class="at">shape =</span> shape_s, <span class="at">scale =</span> scale_s)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(s)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimating-inverted-gamma-2-error-term-variance-prior-scale" class="level2">
<h2 class="anchored" data-anchor-id="estimating-inverted-gamma-2-error-term-variance-prior-scale">Estimating inverted-gamma 2 error term variance prior scale</h2>
<p>In this section, we estimate the error term variance prior scale <span class="math inline">\(s\)</span> that follows a Inverted-gamma 2 distribution with scale <span class="math inline">\(\underline{s}\)</span> and shape <span class="math inline">\(\underline{\mu}\)</span>: <span class="math inline">\(s\sim\mathcal{IG2}(\underline{s},\underline{\mu})\)</span>. The probability density function equal to:</p>
<p><span class="math display">\[
p\left(s\right) = \Gamma(\frac{\underline{\mu}}{2})^{-1} (\frac{\underline{s}}{2})^{\frac{\underline{\mu}}{2}} s^{-\frac{\underline{\mu}+2}{2}}exp\{ -\frac{1}{2}\frac{\underline{s}}{s}\}
\]</span></p>
<p>As we assume <span class="math inline">\(\sigma^2|s \sim \mathcal{IG2} (s,\underline{\nu})\)</span></p>
<p><span class="math display">\[
p\left(\sigma^2|s\right) = \Gamma(\frac{\underline{\nu}}{2})^{-1} (\frac{s}{2})^{\frac{\underline{\nu}}{2}} \sigma^2{^{-\frac{\underline{\nu}+2}{2}}}exp\{-\frac{1}{2}\frac{s}{\sigma^2}\}
\]</span></p>
<p>In order to find full conditional posterior of <span class="math inline">\(s\)</span> write out its kernel as:</p>
<p><span class="math display">\[
\begin{aligned}
p(s|\tau, \sigma^2) &amp;\propto L(\tau, \sigma^2|y) \cdot p(\epsilon|\sigma^2) \cdot p(\sigma^2|s) \cdot p(s) \\
&amp;\propto p(\sigma^2|s) \cdot p(s) \\
&amp;\propto (\frac{s}{2})^{\frac{\underline{\nu}}{2}} exp\{ -\frac{1}{2}\frac{s}{\sigma^2}\} \cdot s^{-\frac{\underline{\mu}+2}{2}}exp\{-\frac{1}{2}\frac{\underline{s}}{s}\} \\
&amp;\propto (\frac{s}{2})^{\frac{\underline{\nu}}{2}} \cdot s^{-\frac{\underline{\mu}+2}{2}} \cdot exp \{-\frac{1}{2}(\frac{\underline{s}}{s} + \frac{s}{\sigma^2} )\}  \\
&amp;\propto (\frac{1}{2}^{\frac{\underline{\nu}}{2}}) \cdot s^{\frac{\underline{\nu}}{2}} \cdot s^{-\frac{\underline{\mu}+2}{2}} \cdot exp \{-\frac{1}{2}(\frac{\underline{s}}{s} + \frac{s}{\sigma^2} )\}  \\
&amp;\propto s^{\frac{\underline{\nu}-\underline{\mu}-2}{2}} exp\{ -\frac{\frac{1}{\sigma^2}s +\frac{s}{\underline{s}}}{2}\}
\end{aligned}
\]</span></p>
<p>from which we recognize a Generalized inverse Gaussian distribution: <span class="math inline">\(\mathcal{GIG}(\overline{p}, \overline{a}, \overline{b})\)</span> with parameters:</p>
<p><span class="math display">\[\begin{align}
\overline{p} &amp;= \frac{\underline{\nu} - \underline{\mu}}{2}\\
\overline{a} &amp;= \frac{1}{\sigma^2 }\\
\overline{b} &amp;= \underline{s }
\end{align}\]</span></p>
<p>The following script illustrates sampling from the full conditional posterior distribution of <span class="math inline">\(s\)</span> and the function <code>s.sampler</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>s.sampler <span class="ot">=</span> <span class="cf">function</span>(sigma2, prior){ </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sigma2 - the current draw</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prior is a list containing:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   s.prior - a positive scalar</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   mu.prior - a scalar</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   nu.prior - a scalar</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  a.bar.s      <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>sigma2</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  b.bar.s      <span class="ot">=</span> (prior<span class="sc">$</span>nu.prior <span class="sc">-</span> prior<span class="sc">$</span>mu.prior)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  p.bar.s      <span class="ot">=</span> prior<span class="sc">$</span>s.prior</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  s    <span class="ot">=</span> GIGrvg<span class="sc">::</span><span class="fu">rgig</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">lambda =</span> p.bar.s, <span class="at">chi =</span> b.bar.s, <span class="at">psi =</span> a.bar.s)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(s)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimating-the-initial-condition-prior-scale" class="level2">
<h2 class="anchored" data-anchor-id="estimating-the-initial-condition-prior-scale">Estimating the initial condition prior scale</h2>
<p>In the univariate local-level model, the initial state <span class="math inline">\(\tau_0\)</span> and the variance <span class="math inline">\(s^2\)</span> are key parameters determining the behavior of the stochastic process. For the initial state <span class="math inline">\(\tau_0\)</span>, a prior is specified as a univariate normal distribution, denoted by</p>
<p><span class="math display">\[\tau_0\mid s^2 \sim \text{N}(\underline\tau_0, s^2)\]</span></p>
<p>reflecting our belief about the distribution of <span class="math inline">\(\tau_0\)</span> before observing the data. While, for the variance <span class="math inline">\(s^2\)</span>, which controls the fluctuation of the process, we use inverse gamma 2 distribution, <span class="math display">\[s^2 \sim \text{IG2}(\underline{s}, \underline{\nu})\]</span></p>
<p>The full posterior of <span class="math inline">\(s^2\)</span> is derived below:</p>
<p><span class="math display">\[\begin{align}
p(s^2|y,\sigma,\tau,\tau_0,\sigma_{\eta}, \underline{s}, \underline{\nu}) &amp;\propto
p(y|\tau,\sigma)p(\tau|\tau_0,\sigma_{\eta}^2)p(\tau_0|s^2)p(s^2) \\
&amp;\propto p(\tau_0|s^2)p(s^2|\underline{s}, \underline{\nu}) \\
&amp;= (s^2)^{-\frac{1}{2}}\exp\left\{-\frac{1}{2}(\tau_0-\underline{\tau_0})'(s^2)^{-1}(\tau_0-\underline{\tau_0})\right\}\\
&amp;\qquad\times (s^2)^{-\frac{\underline{\nu}+2}{2}}\exp\left\{-\frac{1}{2}\frac{\underline{s}}{s^2}\right\} \\
&amp;= (s^2)^{-\frac{1+\underline{\nu}+2}{2}}
\exp \left\{-\frac{1}{2}\frac{(\tau_0-\underline{\tau_0})^2+\underline{s}}{s^2}\right\}
\end{align}\]</span></p>
<p>Hence, full conditional posterior of <span class="math inline">\(s^2\)</span> in a form of inverse gamma 2 distribution, where</p>
<p><span class="math display">\[\begin{align}
s^2\mid \mathbf{y}, \mathbf{\tau}, \tau_0 &amp;\sim\mathcal{IG}2(\overline{s}, \overline{\nu})\\
\overline{\nu} &amp;= 1+\underline{\nu} \\
\overline{s} &amp;= (\tau_0-\underline{\tau_0})^2+\underline{s}
\end{align}\]</span></p>
<p>This R code below implements a sampler from the full-conditional posterior distribution of <span class="math inline">\(s^2\)</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>s2_sampler <span class="ot">&lt;-</span> <span class="cf">function</span>(tau_0, tau_0_prior, s_prior, nu_prior) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    nu_posterior <span class="ot">&lt;-</span> nu_prior <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    s_posterior <span class="ot">&lt;-</span> (tau_0 <span class="sc">-</span> tau_0_prior)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> s_prior</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    s2 <span class="ot">&lt;-</span> s_posterior <span class="sc">/</span> <span class="fu">rchisq</span>(<span class="dv">1</span>, nu_posterior)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(s2)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="student-t-prior-for-the-trend-component" class="level2">
<h2 class="anchored" data-anchor-id="student-t-prior-for-the-trend-component">Student-t prior for the trend component</h2>
</section>
<section id="estimating-student-t-degrees-of-freedom-parameter" class="level2">
<h2 class="anchored" data-anchor-id="estimating-student-t-degrees-of-freedom-parameter">Estimating Student-t degrees of freedom parameter</h2>
<p>The Student-t distribution is commonly used in statistical modeling to handle data with heavier tails than the normal distribution. An essential parameter of the Student-t distribution is the degrees of freedom <span class="math inline">\(\nu\)</span>, which controls the tail heaviness. In this note, we present the Bayesian estimation of the degrees of freedom parameter for a <span class="math inline">\(T\)</span>-variate Student-t distribution represented as an inverted gamma 2 scale mixture of normals:</p>
<p><span class="math display">\[\begin{align}
\mathbf{y} \mid \boldsymbol\tau, \boldsymbol\lambda, \sigma^2 &amp;\sim \mathcal{N}_T(\boldsymbol\tau, \sigma^2diag(\boldsymbol\lambda))\\
\boldsymbol\lambda &amp;= (\lambda_1, \dots, \lambda_T)'\\
\lambda_t \mid \nu &amp;\sim \mathcal{IG2}(\nu - 2, \nu)
\end{align}\]</span></p>
<p>Therefore the joint prior for vector <span class="math inline">\(\boldsymbol\lambda\)</span> is proportional to: <span class="math display">\[
\Gamma\left(\frac{\nu}{2}\right)^{-T}\left(\frac{\nu-2}{2}\right)^{\frac{T\nu}{2}}\left(\prod_{t=1}^T\lambda_t\right)^{-\frac{\nu+2}{2}}\exp\left\{-\frac{\nu-2}{2}\sum_{t=1^T}\lambda_t^{-1}\right\}
\]</span> Assume the following Gamma prior for <span class="math inline">\(\nu\)</span>: <span class="math display">\[
p(\nu) \sim \text{Gamma}(a, b) \propto \nu^{a-1}\exp\{-b\nu\}
\]</span></p>
<p>Therefore the kernel of the full conditional posterior of <span class="math inline">\(\nu\)</span> is defined by: <span class="math display">\[
p(\nu\mid\mathbf{y},\boldsymbol\tau,\boldsymbol\lambda,\sigma^2, \nu) \propto p(,\boldsymbol\lambda\mid\nu)p(\nu)
\]</span></p>
<p>This expression does not lead to a full conditional posterior distribution of a known typ, so we use the Metropolis-Hastings algorithm to sample from this posterior. We employ a random walk proposal distribution with a truncated normal distribution centred at the current value of <span class="math inline">\(\nu\)</span> with a fixed standard deviation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>log_kernel_nu <span class="ot">&lt;-</span> <span class="cf">function</span>(nu, lambda, a, b) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  T <span class="ot">=</span> <span class="fu">length</span>(lambda)  </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  log_c <span class="ot">=</span> <span class="sc">-</span>T <span class="sc">*</span> <span class="fu">lgamma</span>(nu <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">+</span> (T <span class="sc">*</span> nu <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">log</span>((nu <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">2</span>) </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  log_k <span class="ot">=</span> <span class="sc">-</span>((nu <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">log</span>(lambda)) <span class="sc">-</span> ((nu <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">sum</span>(<span class="dv">1</span> <span class="sc">/</span> lambda)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  log_nu <span class="ot">=</span> (a <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">log</span>(nu) <span class="sc">-</span> b <span class="sc">*</span> nu</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(log_c <span class="sc">+</span> log_k <span class="sc">+</span> log_nu)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>sample_nu <span class="ot">&lt;-</span> <span class="cf">function</span>(nu, lambda, a, b, proposal_sd) {</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  T               <span class="ot">=</span> <span class="fu">length</span>(lambda)  </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  nu_proposal     <span class="ot">=</span> RcppTN<span class="sc">::</span><span class="fu">rtn</span>(nu, proposal_sd, <span class="dv">0</span>, <span class="cn">Inf</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  kernel_ratio    <span class="ot">=</span> <span class="fu">exp</span>(<span class="fu">log_kernel_nu</span>(nu_proposal, lambda, a, b) <span class="sc">-</span> <span class="fu">log_kernel_nu</span>(nu, lambda, a, b))</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  candidate_ratio <span class="ot">=</span> RcppTN<span class="sc">::</span><span class="fu">dtn</span>(nu_proposal, nu, proposal_sd, <span class="dv">0</span>, <span class="cn">Inf</span>) <span class="sc">/</span> RcppTN<span class="sc">::</span><span class="fu">dtn</span>(nu, nu_proposal, proposal_sd, <span class="dv">0</span>, <span class="cn">Inf</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  accept_ratio    <span class="ot">=</span> kernel_ratio <span class="sc">*</span> candidate_ratio</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> accept_ratio) {</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    nu <span class="ot">&lt;-</span> nu_proposal</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(nu)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="laplace-prior-for-the-trend-component" class="level2">
<h2 class="anchored" data-anchor-id="laplace-prior-for-the-trend-component">Laplace prior for the trend component</h2>
<p>To apply the Laplace prior for our trend component, we have <span class="math inline">\(\lambda_t\)</span> following an exponential distribution with mean alpha, where <span class="math inline">\(\lambda_t \sim exp({\frac{1}{\alpha}})\)</span>, with the prior of the trend component is <span class="math inline">\(\tau|\eta,\lambda \sim \mathcal{N}(H^{-1}i\tau_0, \sigma_\eta^2 H^{-1}\Omega(H^{-1})')\)</span>, then we have the marginal distribution of <span class="math inline">\(\tau\)</span> is Laplace distribution.</p>
<p>The model is where <span class="math inline">\(\Omega=diag(\lambda_1,\lambda_2,...,\lambda_t)\)</span>, each lambda independently drawn from an exponential distribution.</p>
<p>Due to the change prior distribution of the trend component, now we have different full posterior distributions for parameters and in this note we only focus on the derivation for <span class="math inline">\(\tau\)</span> and <span class="math inline">\(\lambda_t\)</span>. The change of the prior distribution for <span class="math inline">\(\tau\)</span> gives the followings:</p>
<p><span class="math display">\[\tau =y - \epsilon\]</span></p>
<p><span class="math display">\[\tau = H^{-1}i\tau_0 + H^{-1} \eta \]</span></p>
<p><span class="math display">\[\tau|\eta,\lambda \sim \mathcal{N}(H^{-1}i\tau_0, \sigma_\eta^2 H^{-1}\Omega(H^{-1})') \]</span></p>
<p><span class="math display">\[\lambda_t \sim exp({\frac{1}{\alpha}})\]</span></p>
<section id="full-conditional-posterior-distribution-for-tautau_0sigma2omega" class="level3">
<h3 class="anchored" data-anchor-id="full-conditional-posterior-distribution-for-tautau_0sigma2omega">Full-conditional posterior distribution for <span class="math inline">\(\tau|\tau_0,\sigma^2,\Omega\)</span></h3>
<p><strong>Conditional Likelihood:</strong> <span class="math display">\[\tau =y - \epsilon\]</span></p>
<p><span class="math display">\[\epsilon \sim \mathcal{N}(0_T, \sigma^2I_T)\]</span></p>
<p><span class="math display">\[L(\tau|y,\sigma^2) = exp({-\frac{1}{2}\frac{1}{\sigma^2}(\mathbf{y} - \boldsymbol\tau)'(\mathbf{y} - \boldsymbol\tau)})\]</span></p>
<p>The <strong>prior distribution</strong> of <span class="math inline">\(\tau\)</span>is:</p>
<p><span class="math display">\[p(\tau|\tau_0,\sigma_\eta^2,\Omega) \propto exp(-\frac{1}{2}\frac{1}{\sigma_\eta^2}(\tau - H^{-1}i\tau_0)'H'\Omega^{-1}H(\tau - H^{-1}i\tau_0))\]</span></p>
<p><strong>Full-conditional posterior distribution</strong> of <span class="math inline">\({\tau}|y,\sigma_\eta^2,\Omega\)</span>:</p>
<p><span class="math display">\[\begin{align}
P(\tau|y,\tau_0,\sigma^2,\Omega) &amp;\propto L(\tau|y,\sigma^2)\times p(\tau|\tau_0,\sigma_\eta^2,\Omega)\\

&amp;\propto exp({-\frac{1}{2}}\sigma^{-2}\ \times (\tau'\tau -2y'\tau+y'y))\\
&amp;\times exp({-\frac{1}{2}\sigma_\eta^{-2}\ (\tau'H'\Omega^{-1}H\tau - 2\tau'H'\Omega^{-1}H(H^{-1}i\tau_0) +(H^{-1}i\tau_0)'H\Omega^{-1}H(H^{-1}i\tau_0)}\\

&amp;\propto exp({-\frac{1}{2}}\sigma^{-2}\sigma_\eta^{-2}[\tau'(\sigma_\eta^2+\sigma^2H'\Omega^{-1}H)\tau-2\tau'(\sigma_\eta^2y+\sigma^2H'\Omega^{-1}H(H^{-1}i\tau_0))])\\

&amp;= exp({-\frac{1}{2}}(\tau'(\sigma^{-2}+\sigma_\eta^{-2}H'\Omega^{-1}H\tau-2\tau'(\sigma^{-2}y+\sigma_\eta^{-2}H'\Omega^{-1}H(H^{-1}i\tau_0))
\end{align}\]</span></p>
<p>which results in</p>
<p><span class="math display">\[\begin{align}
\tau|y,\tau_0,\sigma^2,\Omega&amp;\sim N(\bar{V_\tau},\bar{\tau})\\[1ex]
\bar{V_\tau} &amp;= (\sigma^{-2}+\sigma_\eta^{-2}H'\Omega^{-1}H)^{-1}\\
\bar{\tau} &amp;=\bar{V_\tau} (\sigma^{-2}y+\sigma_\eta^{-2}H'\Omega^{-1}i\tau_0)
\end{align}\]</span></p>
</section>
<section id="full-conditional-posterior-distribution-for-lambda_tytausigma_eta2" class="level3">
<h3 class="anchored" data-anchor-id="full-conditional-posterior-distribution-for-lambda_tytausigma_eta2">Full-conditional posterior distribution for <span class="math inline">\(\lambda_t|y,\tau,\sigma_\eta^2\)</span></h3>
<p><strong>Conditional Likelihood:</strong></p>
<p>Define: <span class="math inline">\(H\tau - i\tau_o=\eta\)</span></p>
<p><span class="math display">\[\begin{align}
L(\lambda_t|y,\tau_0,\tau,\sigma_\eta^2)&amp;\propto  (\prod^{T}_{i = 1} \lambda_t^{-\frac{1}{2}}) exp({-\frac{1}{2}\frac{1}{\sigma^2_\eta}(i\tau_0-H\tau)'\Omega^{-1}(i\tau_0-H\tau)})\\
&amp;= (\prod^{T}_{i = 1} \lambda_t^{-\frac{1}{2}}exp({-\frac{1}{2}\frac{1}{\sigma^2_\eta}\frac{1}{\lambda_t}\eta_t'\eta_t}))                

\end{align}\]</span></p>
<p>The <strong>prior distribution</strong> of <span class="math inline">\(\lambda_t\)</span> is:</p>
<p><span class="math display">\[
P(\lambda_t) ={\frac{1}{\alpha}}exp({{-\frac{1}{\alpha}}\lambda_t)})
\]</span></p>
<p><strong>Full-conditional posterior distribution</strong> of <span class="math inline">\(\lambda_t\)</span>is:</p>
<p><span class="math display">\[\begin{align}
P(\lambda_t|y,\tau,\sigma_\eta^2) &amp;\propto \lambda_t^{-\frac{1}{2}+1-1}exp(-\frac{1}{2}({\frac{\eta_t'\sigma_\eta^{-2}\eta_t}{\lambda_t}+{\frac{2}{\alpha}}\lambda_t)}) \\
\end{align}\]</span></p>
<p>The above expression can be rearranged in the form of a Generalized inverse Gaussian distribution kernel as follows:</p>
<p><span class="math display">\[\begin{align}
\lambda_t|Y,A,\Sigma &amp;\sim GIG(a,b,p) \\
\\
a &amp;=\frac{2}{\alpha} \\
b &amp;= \eta_t'\sigma_\eta^{-2}\eta_t \\
p &amp;= -\frac{1}{2}+1
\end{align}\]</span></p>
</section>
<section id="r-function-for-gibbs-sampler" class="level3">
<h3 class="anchored" data-anchor-id="r-function-for-gibbs-sampler">R Function for Gibbs Sampler</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>UC.AR.Gibbs.sampler    <span class="ot">=</span> <span class="cf">function</span>(S, starting.values, priors){</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  aux     <span class="ot">=</span> starting.values</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  p       <span class="ot">=</span> <span class="fu">length</span>(aux<span class="sc">$</span>alpha)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  T       <span class="ot">=</span> <span class="fu">nrow</span>(aux<span class="sc">$</span>Y)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, T, <span class="dv">1</span>)  </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  i[<span class="dv">1</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  posteriors    <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau     =</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,T,S),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,T,S),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">tau_0   =</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="dv">1</span>,S),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma   =</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="dv">2</span>,S)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  lambda<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="fu">rexp</span>(T, <span class="at">rate =</span> <span class="dv">1</span><span class="sc">/</span>alpha)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  lambda.priors <span class="ot">=</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">2</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  lambda.posterior.draws <span class="ot">=</span> <span class="fu">array</span>(<span class="cn">NA</span>,<span class="fu">c</span>(T,S<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S){</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (s <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>      lambda.s <span class="ot">=</span> lambda<span class="fl">.0</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>      lambda.s    <span class="ot">=</span> lambda.posterior.draws[,s]</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    Omega <span class="ot">=</span> (<span class="fu">diag</span>(lambda.s))</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    Omega.inv <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span>lambda.s)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sampling tau</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    V.tau.inv     <span class="ot">=</span> (<span class="dv">1</span><span class="sc">/</span>aux<span class="sc">$</span>sigma[<span class="dv">2</span>]) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span>aux<span class="sc">$</span>sigma[<span class="dv">1</span>])<span class="sc">*</span><span class="fu">t</span>(H) <span class="sc">%*%</span> Omega.inv <span class="sc">%*%</span> H</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    V.tau.inv     <span class="ot">=</span> <span class="fl">0.5</span><span class="sc">*</span>(V.tau.inv <span class="sc">+</span> <span class="fu">t</span>(V.tau.inv))</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    b.tau         <span class="ot">=</span> (<span class="dv">1</span><span class="sc">/</span>aux<span class="sc">$</span>sigma[<span class="dv">2</span>])<span class="sc">%*%</span>aux<span class="sc">$</span>Y <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span>aux<span class="sc">$</span>sigma[<span class="dv">1</span>])<span class="sc">*</span><span class="fu">crossprod</span>(H, Omega.inv<span class="sc">%*%</span>i<span class="sc">%*%</span>priors<span class="sc">$</span>tau_0)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    precision.L   <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">bandchol</span>(V.tau.inv))</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    epsilon       <span class="ot">=</span> <span class="fu">rnorm</span>(T)</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    b.tau.tmp     <span class="ot">=</span> <span class="fu">forwardsolve</span>(precision.L, b.tau)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    tau.draw      <span class="ot">=</span> <span class="fu">backsolve</span>(<span class="fu">t</span>(precision.L), b.tau.tmp <span class="sc">+</span> epsilon)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    aux<span class="sc">$</span>tau       <span class="ot">=</span> tau.draw</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sampling tau_0</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    tau_0.v.inv    <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span>priors<span class="sc">$</span>tau_0.v)</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    V.tau_0.bar    <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>((<span class="dv">1</span><span class="sc">/</span>aux<span class="sc">$</span>sigma[<span class="dv">1</span>])<span class="sc">*</span><span class="fu">crossprod</span>(i,Omega.inv<span class="sc">%*%</span>i) <span class="sc">+</span> tau_0.v.inv)</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    tau_0.bar      <span class="ot">=</span> V.tau_0.bar <span class="sc">%*%</span> ( (<span class="dv">1</span><span class="sc">/</span>aux<span class="sc">$</span>sigma[<span class="dv">1</span>])<span class="sc">%*%</span><span class="fu">t</span>(i)<span class="sc">%*%</span>Omega.inv<span class="sc">%*%</span>H<span class="sc">%*%</span>aux<span class="sc">$</span>tau <span class="sc">+</span> tau_0.v.inv <span class="sc">*</span> priors<span class="sc">$</span>tau_0.m )</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    tau_0.draw     <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="fu">as.numeric</span>(tau_0.bar), <span class="fu">sqrt</span>(V.tau_0.bar))</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    aux<span class="sc">$</span>tau_0      <span class="ot">=</span> <span class="fu">as.vector</span>(tau_0.draw)</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sampling sigma_epsilon</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    sigma.eta.s   <span class="ot">=</span> <span class="fu">as.numeric</span>(priors<span class="sc">$</span>sigma.s <span class="sc">+</span> <span class="fu">crossprod</span>((<span class="fu">c</span>(aux<span class="sc">$</span>tau_0[<span class="dv">1</span>],<span class="fu">diff</span>(aux<span class="sc">$</span>tau_0)) <span class="sc">-</span> i<span class="sc">%*%</span>aux<span class="sc">$</span>tau_0),(priors<span class="sc">$</span>H<span class="sc">%*%</span>aux<span class="sc">$</span>tau <span class="sc">-</span> i<span class="sc">%*%</span>aux<span class="sc">$</span>tau_0)))</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>    sigma.eta.nu  <span class="ot">=</span> priors<span class="sc">$</span>sigma.nu <span class="sc">+</span> T</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    sigma.eta.draw<span class="ot">=</span> sigma.eta.s<span class="sc">/</span><span class="fu">rchisq</span>(<span class="dv">1</span>,sigma.eta.nu)</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    sigma.eta.draw.inv<span class="ot">=</span><span class="dv">1</span><span class="sc">/</span>(sigma.eta.draw)</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>    sigma.e.s     <span class="ot">=</span> <span class="fu">as.numeric</span>(priors<span class="sc">$</span>sigma.s <span class="sc">+</span> <span class="fu">crossprod</span>(aux<span class="sc">$</span>tau<span class="sc">-</span>aux<span class="sc">$</span>Y))</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>    sigma.e.nu    <span class="ot">=</span> priors<span class="sc">$</span>sigma.nu <span class="sc">+</span> T</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    sigma.e.draw  <span class="ot">=</span> sigma.e.s<span class="sc">/</span><span class="fu">rchisq</span>(<span class="dv">1</span>,sigma.e.nu)</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    aux<span class="sc">$</span>sigma     <span class="ot">=</span> <span class="fu">c</span>(sigma.eta.draw,sigma.e.draw)</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sampling lambda</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>    u.t <span class="ot">=</span> H<span class="sc">%*%</span>aux<span class="sc">$</span>tau[,,s]<span class="sc">-</span>i<span class="sc">%*%</span>aux<span class="sc">$</span>tau_0[,,s]</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">#    ---- loop lambda posterior ----   #</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>    c                      <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>         </span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>    a                      <span class="ot">=</span> <span class="dv">2</span> <span class="sc">/</span> lambda.priors<span class="sc">$</span>alpha</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>T){</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>      b                  <span class="ot">=</span> <span class="fu">t</span>((u.t)[x,])<span class="sc">%*%</span>(<span class="dv">1</span><span class="sc">/</span>aux<span class="sc">$</span>sigma[<span class="dv">1</span>][,,s])<span class="sc">%*%</span>(u.t)[x,]</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>      lambda.posterior.draws[x,s<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> GIGrvg<span class="sc">::</span><span class="fu">rgig</span>(<span class="dv">1</span>, <span class="at">lambda =</span> c, <span class="at">chi =</span> b, <span class="at">psi =</span> a)</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>    aux<span class="sc">$</span>lambda <span class="ot">=</span> lambda.posterior.draws</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>    posteriors<span class="sc">$</span>tau[,s]     <span class="ot">=</span> aux<span class="sc">$</span>tau</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>    posteriors<span class="sc">$</span>tau_0[,s]   <span class="ot">=</span> aux<span class="sc">$</span>tau_0</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>    posteriors<span class="sc">$</span>lambda[,s]  <span class="ot">=</span> aux<span class="sc">$</span>lambda</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>    posteriors<span class="sc">$</span>sigma[,s]   <span class="ot">=</span> aux<span class="sc">$</span>sigma</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>  output      <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">posterior =</span> posteriors,</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">last.draw =</span> aux</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="model-extensions" class="level1">
<h1>Model extensions</h1>
<section id="estimation-of-autoregressive-parameters-for-cycle-component" class="level2">
<h2 class="anchored" data-anchor-id="estimation-of-autoregressive-parameters-for-cycle-component">Estimation of autoregressive parameters for cycle component</h2>
</section>
<section id="autoregressive-cycle-component" class="level2">
<h2 class="anchored" data-anchor-id="autoregressive-cycle-component">Autoregressive cycle component</h2>
<p>In this section, we will modify the error component <span class="math inline">\(\epsilon_{t}\)</span> from the simple local-level model to take the form of an autoregressive (AR) expression as follows <span class="math display">\[\begin{align}
\epsilon_{t} &amp;= \alpha_{1}\epsilon_{t-1} + \alpha_{2}\epsilon_{t-2} + \cdots  + \alpha_{p}\epsilon_{t-p} + e_{t},\\
e_{t}&amp;\sim \mathcal{N}(0,\sigma_{e}^{2}).
\end{align}\]</span></p>
<p>Collect vector of autoregressive parametersin a <span class="math inline">\(p\)</span>-vector <span class="math inline">\(\boldsymbol\alpha = (\alpha_{1},\alpha_{2}, \cdots, \alpha_{p})'\)</span>, where <span class="math inline">\(\boldsymbol\alpha \in A\)</span>, with the stationarity restriction being required to hold.</p>
<p>By modelling the error component in an autoregressive form, we enable our model to capture the cyclical component, capturing its negative autocorrelations, and allowing the series to deviate from the long-term stochastic trend (<span class="math inline">\(\tau_{t}\)</span>) in the short run.</p>
<p><strong>The matrix notation can be represented as:</strong></p>
<span class="math display">\[\begin{align}
\mathbf{H}_{\alpha} \boldsymbol\epsilon &amp;= \mathbf{e} \\
\boldsymbol\epsilon &amp;= H_{\alpha}^{-1}\mathbf{e} \\
\mathbf{e} &amp;\sim \mathcal{N}_{T}(\mathbf{0}_{T},\sigma_{e}^{2} \mathbf{I}_{T})
\end{align}\]</span>
<p>Where</p>
<p><span class="math display">\[
\mathbf{H}_{\alpha} =
\begin{bmatrix}
1  &amp;0  &amp;0  &amp;0  &amp;0  &amp;\cdots  &amp;0  &amp;0  &amp;0  &amp;0 \\
-\alpha_{1}  &amp;1  &amp;0  &amp;0  &amp;0  &amp;\cdots  &amp;0  &amp;0  &amp;0  &amp;0 \\
-\alpha_{2}  &amp;-\alpha_{1}  &amp;1  &amp;0  &amp;0  &amp;\cdots  &amp;\vdots  &amp;\vdots  &amp;\vdots  &amp;\vdots \\
-\alpha_{3}  &amp;-\alpha_{2}  &amp;-\alpha_{1}  &amp;1  &amp;0  &amp;\ddots  &amp;\vdots  &amp;\vdots  &amp;\vdots  &amp;\vdots \\
\vdots   &amp;\vdots  &amp;\ddots  &amp;\ddots  &amp; \ddots &amp;\ddots  &amp;\vdots  &amp;\vdots  &amp;\vdots &amp;\vdots \\
-\alpha_{p}  &amp;-\alpha_{p-1}  &amp;-\alpha_{p-2} &amp;\ddots  &amp;\ddots  &amp;\ddots  &amp;0  &amp;0  &amp;0  &amp;0 \\
\vdots  &amp;\vdots  &amp;\vdots  &amp;\vdots  &amp;\ddots  &amp;\ddots  &amp;\ddots  &amp;\vdots  &amp;\vdots &amp;\vdots  \\
\vdots  &amp;\vdots  &amp;\vdots  &amp;\vdots  &amp;\cdots  &amp;\ddots  &amp;-\alpha_{1}  &amp;1  &amp;0  &amp;0 \\
0  &amp;0  &amp;0  &amp;0  &amp;\cdots  &amp;\cdots   &amp;-\alpha_{2}   &amp;-\alpha_{1} &amp;1 &amp;0 \\
0  &amp;0  &amp; 0 &amp;0  &amp;\cdots  &amp;\cdots  &amp;-\alpha_{3}  &amp;-\alpha_{2}  &amp;-\alpha_{1} &amp;1
\end{bmatrix}_{T\times T}
\]</span></p>
<span class="math display">\[\begin{align}
\boldsymbol\epsilon =
\begin{bmatrix}
\epsilon_{1} \\
\epsilon_{2}\\
\vdots\\
\epsilon_{T}\\
\end{bmatrix}_{T\times 1}
\qquad and \qquad
\mathbf{e} =
\begin{bmatrix}
e_{1} \\
e_{2}\\
\vdots\\
e_{T}\\
\end{bmatrix}_{T\times 1}

\end{align}\]</span>
<p><br></p>
<p>Typically, in most cases, we set the initial value (<span class="math inline">\(\boldsymbol\epsilon_{0}\)</span>) to zero since it aligns with the well-defined stationarity assumption. However, in this note, these values are estimated <span class="math inline">\(\boldsymbol\epsilon_{0}\)</span> from an autoregressive model, which is facilitated by assuming a normal prior distribution: <span class="math inline">\(\boldsymbol\epsilon_{0} \sim \mathcal{N}_{p}(\mathbf{0}_{p},\sigma_{0}^{2}\mathbf{I}_{p})\)</span> and that <span class="math inline">\(\mathbf{e}_{0} \sim \mathcal{N}_{p}(\mathbf{0}_{p},\sigma_{e}^{2}\mathbf{I}_{p})\)</span>. Define:</p>
<span class="math display">\[\begin{align}
\boldsymbol\epsilon_{0} =
\begin{bmatrix}
\epsilon_{-p+1}   \\
\epsilon_{-p+2}   \\
\vdots\\
\epsilon_{0}
\end{bmatrix}_{p\times 1},
\qquad and \qquad
\mathbf{e}_{0} =
\begin{bmatrix}
e_{-p+1}   \\
e_{-p+2}   \\
\vdots\\
e_{0}
\end{bmatrix}_{p\times 1}

\end{align}\]</span>
<p>Then, the author will combine <span class="math inline">\(\boldsymbol\epsilon\)</span> and <span class="math inline">\(\boldsymbol\epsilon_{0}\)</span> together. This can be represented using the notations <span class="math inline">\(\mathbf{H}_{\alpha}^{*}\)</span>, <span class="math inline">\(\boldsymbol\epsilon^{*}\)</span>, and <span class="math inline">\(\mathbf{e}^{*}\)</span>.</p>
<p><span class="math inline">\(\mathbf{H}_{\alpha}^{*}\)</span> is constructed in the same way as <span class="math inline">\(\mathbf{H}_{\alpha}\)</span>, but the dimension increases to <span class="math inline">\((T+p)\times (T+p)\)</span>.</p>
<span class="math display">\[\begin{align}
\boldsymbol\epsilon^{*} =
\begin{bmatrix}
\epsilon_{0}   \\
\epsilon
\end{bmatrix}_{(T+p)\times 1}  =
\begin{bmatrix}
\epsilon_{-p+1}   \\
\epsilon_{-p+2}   \\
\vdots\\
\epsilon_{1} \\
\epsilon_{2} \\
\vdots\\
\epsilon_{T}
\end{bmatrix}_{(T+p)\times 1}
\qquad and \qquad
\mathbf{e}^{*} =
\begin{bmatrix}
e_{0}   \\
e
\end{bmatrix}_{(T+p)\times 1}
=
\begin{bmatrix}
e_{-p+1}   \\
e_{-p+2}   \\
\vdots\\
e_{1} \\
e_{2} \\
\vdots\\
e_{T}
\end{bmatrix}_{(T+p)\times 1}
\end{align}\]</span>
<p><strong>The matrix notation can be represented as:</strong></p>
<span class="math display">\[\begin{align}
\mathbf{H}_{\alpha}^{*} \boldsymbol\epsilon^{*} &amp;=\mathbf{e}^{*} \\
\boldsymbol\epsilon^{*} &amp;= \mathbf{H}^{*-1}_{\alpha}\mathbf{e}^{*} \\

\mathbf{e}^{*} &amp;\sim \mathcal{N}_{T+p}(\mathbf{0}_{T+p},\sigma_{e*}^{2}\mathbf{I}_{T+p})
\end{align}\]</span>
<p>Then</p>
<span class="math display">\[\begin{align}

\boldsymbol\epsilon^{*}|\boldsymbol\alpha,\sigma_{e}^2 &amp;\sim \mathcal{N}_{T+p}(\mathbf{0}_{T+p},\underbrace{\sigma_{e*}^2(\mathbf{H}_{\alpha}^{*'}\mathbf{H}_{\alpha}^{*})^{-1}}_{{\boldsymbol\Omega}})
\end{align}\]</span>
<span class="math display">\[\begin{align}
\boldsymbol\Omega = \begin{bmatrix}
\boldsymbol\Omega_{11}&amp; \boldsymbol\Omega_{12}\\
\boldsymbol\Omega_{21}&amp; \boldsymbol\Omega_{21}
\end{bmatrix} \\
\end{align}

\text{ with dimensions}

\begin{bmatrix}
pXP&amp;pXT\\
TXp&amp;TXT
\end{bmatrix}_{(T+p)X(T+p)} \\
\]</span>
<section id="the-prior-distribution" class="level3">
<h3 class="anchored" data-anchor-id="the-prior-distribution">The prior distribution</h3>
<p>Using knowledge from the conditional distributions of multivariate normal distribution, we can find the prior distribution of <span class="math inline">\(\boldsymbol\epsilon \text{ and } \boldsymbol\epsilon_{0}\)</span> as follows.</p>
<ol type="1">
<li>The prior distribution of <span class="math inline">\(\boldsymbol\epsilon\)</span></li>
</ol>
<span class="math display">\[\begin{align}

\boldsymbol\epsilon|\boldsymbol\epsilon_{0},\boldsymbol\alpha,\sigma_{e*}^2 &amp;\sim \mathcal{N}_{T}(\underbrace{\boldsymbol\Omega_{21}\boldsymbol\Omega_{11}^{-1}\boldsymbol\epsilon_{0}}_{\underline{\boldsymbol\epsilon}},\underbrace{\boldsymbol\Omega_{22}-\boldsymbol\Omega_{21}\boldsymbol\Omega_{11}^{-1}\boldsymbol\Omega_{12}}_{\underline{\mathbf{V}}_{\epsilon}}) \\
&amp;\propto exp\left\{-\frac{1}{2} (\boldsymbol\epsilon-\underline{\boldsymbol\epsilon})' \underline{\mathbf{V}}_{\epsilon}^{-1} (\boldsymbol\epsilon-\underline{\boldsymbol\epsilon})\right\}


\end{align}\]</span>
<ol start="2" type="1">
<li>The prior distribution of <span class="math inline">\(\boldsymbol\epsilon_{0}\)</span></li>
</ol>
<span class="math display">\[\begin{align}

\boldsymbol\epsilon_{0}|\boldsymbol\epsilon,\boldsymbol\alpha,\sigma_{e*}^2 &amp;\sim \mathcal{N}_{P}(\underbrace{\boldsymbol\Omega_{12}\boldsymbol\Omega_{22}^{-1}\boldsymbol\epsilon}_{\underline{\boldsymbol\epsilon}_{0}},\underbrace{\boldsymbol\Omega_{11}-\boldsymbol\Omega_{12}\boldsymbol\Omega_{22}^{-1}\boldsymbol\Omega_{21}}_{\underline{\mathbf{V}}_{\epsilon_{0}}}) \\

&amp;\propto exp\left\{-\frac{1}{2} (\boldsymbol\epsilon_{0}-\underline{\boldsymbol\epsilon}_{0})' \underline{\mathbf{V}}_{\epsilon_{0}}^{-1}  (\boldsymbol\epsilon_{0}-\underline{\boldsymbol\epsilon}_{0})\right\}


\end{align}\]</span>
</section>
<section id="likelihood" class="level3">
<h3 class="anchored" data-anchor-id="likelihood">Likelihood</h3>
<p>From the simple local-level model we can write</p>
<span class="math display">\[\begin{align}
\mathbf{y} &amp;= \boldsymbol\tau + \boldsymbol\epsilon,\\
\mathbf{H}\boldsymbol\tau &amp;= \mathbf{i} \tau_0 + \boldsymbol\eta,\\
\boldsymbol\tau &amp;= \mathbf{H}^{-1} \mathbf{i} \tau_0 + \mathbf{H}^{-1} \boldsymbol\eta
\end{align}\]</span>
<p>Then,</p>
<span class="math display">\[\begin{align}
\boldsymbol\epsilon &amp;= \mathbf{y} - \boldsymbol\tau \\
\boldsymbol\epsilon &amp;\sim N(\mathbf{y}-\mathbf{H}^{-1} \mathbf{i} \tau_0, \sigma_{\eta}^2 \mathbf{I}_{T} (\mathbf{H}'\mathbf{H})^{-1})\\
L(\boldsymbol\epsilon|\mathbf{y},\boldsymbol\tau,\tau_0, \sigma_{\eta}^2)  &amp;\propto exp\{-\frac{1}{2}\frac{1}{\sigma_{\eta}^2}(\boldsymbol\epsilon-(\mathbf{y}-\mathbf{H}^{-1} \mathbf{i} \tau_0))' \mathbf{H}'\mathbf{H} (\boldsymbol\epsilon-(\mathbf{y}-\mathbf{H}^{-1} \mathbf{i} \tau_0))
\end{align}\]</span>
</section>
<section id="the-full-conditional-posterior-distribution" class="level3">
<h3 class="anchored" data-anchor-id="the-full-conditional-posterior-distribution">The full-conditional posterior distribution</h3>
<ol type="1">
<li>The full-conditional posterior distribution of <span class="math inline">\(\boldsymbol\epsilon\)</span></li>
</ol>
<span class="math display">\[\begin{align}
p(\boldsymbol\epsilon|\boldsymbol\epsilon_{0},\mathbf{y},\boldsymbol\tau,\tau_0, \sigma_{\eta}^2, \underline{\mathbf{V}}_{\epsilon}) &amp;\propto L(\boldsymbol\epsilon|\mathbf{y},\boldsymbol\tau,\tau_0,\sigma_{\eta}^2) \; p(\boldsymbol\epsilon|\boldsymbol\epsilon_{0},\boldsymbol\alpha,\sigma_{e*}^2) \\
&amp;= \mathcal{N}_{T}(\bar{\boldsymbol\epsilon},\bar{\mathbf{V}}_{\epsilon}) \\

\\

\bar{\mathbf{V}}_{\epsilon} &amp;= \left[\underline{\mathbf{V}}^{-1}_{\epsilon} + \sigma_{\eta}^{-2}\mathbf{H}'\mathbf{H}\right]^{-1} \\
\bar{\boldsymbol\epsilon} &amp;= \bar{\mathbf{V}}_{\epsilon} \left[\sigma_{\eta}^{-2} \mathbf{H}'\mathbf{H} (\mathbf{y}-\mathbf{H}^{-1} \mathbf{i} \tau_0) + \underline{\mathbf{V}}^{-1}_{\epsilon}\; \underline{\boldsymbol\epsilon}\right]

\end{align}\]</span>
<ol start="2" type="1">
<li>The full-conditional posterior distribution of <span class="math inline">\(\boldsymbol\epsilon_{0}\)</span></li>
</ol>
<span class="math display">\[\begin{align}

p(\boldsymbol\epsilon_{0}|\epsilon,\mathbf{y},\boldsymbol\tau,\tau_0, \sigma_{\eta}^2,\underline{\mathbf{V}}_{\epsilon_{0}}) &amp;\propto L(\boldsymbol\epsilon|\mathbf{y},\boldsymbol\tau,\tau_0,\sigma_{\eta}^2) \; p(\boldsymbol\epsilon_{0}) \; p(\boldsymbol\epsilon_{0}|\boldsymbol\epsilon,\boldsymbol\alpha,\sigma_{e*}^2) \\


&amp;\propto p(\boldsymbol\epsilon_{0}) \; p(\boldsymbol\epsilon_{0}|\boldsymbol\epsilon,\boldsymbol\alpha,\sigma_{e*}^2) \\

&amp;= \mathcal{N}_{p}(\bar{\boldsymbol\epsilon_{0}},\bar{\mathbf{V}}_{\epsilon_{0}}) \\

\\

\bar{\mathbf{V}}_{\epsilon_{0}} &amp;= \left[\underline{\mathbf{V}}^{-1}_{\epsilon_{0}} + \sigma_{0}^{-2} \mathbf{I}_{p}\right]^{-1} \\
\bar{\boldsymbol\epsilon_{0}} &amp;= \bar{\mathbf{V}}_{\epsilon_{0}} \; \underline{\boldsymbol\epsilon_{0}}

\end{align}\]</span>
</section>
<section id="the-sampler-function" class="level3">
<h3 class="anchored" data-anchor-id="the-sampler-function">The Sampler function</h3>
<p>Given that we have priors and other sampling parameters from another function, and also some fixed matrices such as <span class="math inline">\(\mathbf{H}'\mathbf{H}\)</span> and <span class="math inline">\(\mathbf{H^{*}}_{\alpha}'\mathbf{H^{*}}_{\alpha}\)</span>.</p>
<p>We can sampling each of <span class="math inline">\(\epsilon\)</span> and <span class="math inline">\(\epsilon_{0}\)</span> from the following function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>Sampling.epsilon.epsilonzero    <span class="ot">=</span> <span class="cf">function</span>(starting.values, priors){</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  aux            <span class="ot">=</span> starting.values</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  p              <span class="ot">=</span> <span class="fu">length</span>(aux<span class="sc">$</span>alpha)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  T              <span class="ot">=</span> <span class="fu">nrow</span>(aux<span class="sc">$</span>Y)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  Ha             <span class="ot">=</span> <span class="fu">diag</span>(T <span class="sc">+</span> p)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p) {</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    mgcv<span class="sc">::</span><span class="fu">sdiag</span>(Ha, <span class="sc">-</span>i) <span class="ot">&lt;-</span> <span class="sc">-</span> aux<span class="sc">$</span>alpha[i]</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  HaHa           <span class="ot">=</span> <span class="fu">crossprod</span>(Ha)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Start calculating (and updating parameters)</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    epsilon.star        <span class="ot">=</span> <span class="fu">rbind</span>(aux<span class="sc">$</span>epsilon.zero, aux<span class="sc">$</span>epsilon)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    omega               <span class="ot">=</span> sigma.e.star<span class="sc">%*%</span><span class="fu">solve</span>(HaHa)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    omega_11            <span class="ot">=</span> omega[<span class="dv">1</span><span class="sc">:</span>p, <span class="dv">1</span><span class="sc">:</span>p]</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    omega_12            <span class="ot">=</span> omega[<span class="dv">1</span><span class="sc">:</span>p, (p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(p<span class="sc">+</span>T)]</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    omega_21            <span class="ot">=</span> omega[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(p<span class="sc">+</span>T), <span class="dv">1</span><span class="sc">:</span>p]</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    omega_22            <span class="ot">=</span> omega[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(p<span class="sc">+</span>T), (p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(p<span class="sc">+</span>T)]</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    epsilon             <span class="ot">=</span> omega_21<span class="sc">%*%</span><span class="fu">solve</span>(omega_11)<span class="sc">%*%</span>aux<span class="sc">$</span>epsilon.zero</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    epsilon.zero        <span class="ot">=</span> omega_12<span class="sc">%*%</span><span class="fu">solve</span>(omega_22)<span class="sc">%*%</span>aux<span class="sc">$</span>epsilon</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    V.epsilon           <span class="ot">=</span> omega_22 <span class="sc">-</span> omega_21<span class="sc">%*%</span><span class="fu">solve</span>(omega_11)<span class="sc">%*%</span>omega_12</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    V.epsilon.zero      <span class="ot">=</span> omega_11 <span class="sc">-</span> omega_12<span class="sc">%*%</span><span class="fu">solve</span>(omega_22)<span class="sc">%*%</span>omega_21</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sampling epsilon</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    V.epsilon.post.inv     <span class="ot">=</span> <span class="fu">solve</span>(V.epsilon) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span>aux<span class="sc">$</span>sigma.eta)<span class="sc">*</span>HH</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    b.epsilon              <span class="ot">=</span> (<span class="dv">1</span><span class="sc">/</span>aux<span class="sc">$</span>sigma.eta)<span class="sc">*</span>HH<span class="sc">%*%</span>(aux<span class="sc">$</span>Y<span class="sc">-</span> <span class="fu">cumsum</span>(i<span class="sc">%*%</span>priors<span class="sc">$</span>tau_0)) <span class="sc">+</span> </span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">solve</span>(V.epsilon)<span class="sc">%*%</span>aux<span class="sc">$</span>epsilon</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    precision.L            <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">chol</span>(V.epsilon.post.inv))</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    epsilon.n              <span class="ot">=</span> <span class="fu">rnorm</span>(T)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    b.epsilon.tmp          <span class="ot">=</span> <span class="fu">solve</span>(precision.L, b.epsilon)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    epsilon.draw           <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(precision.L), b.epsilon.tmp <span class="sc">+</span> epsilon.n)</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    aux<span class="sc">$</span>epsilon            <span class="ot">=</span> epsilon.draw</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sampling epsilon.zero</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    V.epsilon.zero.post.inv     <span class="ot">=</span> <span class="fu">solve</span>(V.epsilon.zero) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">/</span>sigma.zero)<span class="sc">*</span><span class="fu">diag</span>(p)</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    b.epsilon.zero              <span class="ot">=</span> epsilon.zero</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    precision.L                 <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">chol</span>(V.epsilon.zero.post.inv))</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    epsilon.n                   <span class="ot">=</span> <span class="fu">rnorm</span>(p)</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    b.epsilon.zero.tmp          <span class="ot">=</span> <span class="fu">solve</span>(precision.L, b.epsilon.zero)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    epsilon.zero.draw           <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(precision.L), b.epsilon.zero.tmp <span class="sc">+</span> epsilon.n)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    aux<span class="sc">$</span>epsilon.zero            <span class="ot">=</span> epsilon.zero.draw</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The draw</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  output      <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">epsilon_draw =</span> epsilon.draw, <span class="co"># Drawn epsilon values</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">epsilon_zero_draw =</span> epsilon.zero.draw <span class="co"># Drawn epsilon.zero values</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="random-walk-with-time-varying-drift-parameter" class="level2">
<h2 class="anchored" data-anchor-id="random-walk-with-time-varying-drift-parameter">Random walk with time-varying drift parameter</h2>
<p>Consider a simple Unobserved Component model with time-varying drift parameter <span class="math display">\[\begin{align}
\tau_{t} &amp;= \mu_{s_t} + \tau_{t-1} + \eta_t,\\
\eta_t &amp;\sim \mathcal{N}(0, \sigma_{\eta}^2),
\end{align}\]</span> where <span class="math inline">\(\mu_{s_t}\)</span> is a regime-dependent mean term, and <span class="math inline">\(s_t\)</span> is a regime state variable. Assume there are two regimes, for example, before and after the exchange rate crisis in 1985. Define:</p>
<p><span class="math display">\[s_t = \left\{\begin{array}{ll}1 &amp;\text{ for }t &lt; Tb \\  2 &amp;\text{ for }t \geq Tb\end{array}\right.\]</span></p>
<p>To write a model in a matrix notation, define vector <span class="math inline">\(\boldsymbol\beta = \begin{bmatrix}\tau_0 &amp;\mu_1 &amp;\mu_2\end{bmatrix}'\)</span> and matrix: <span class="math display">\[\begin{align}
\mathbf{X}_{\tau} = \begin{bmatrix}
1 &amp; 1 &amp; 0 \\
0 &amp; 1 &amp; 0 \\
0 &amp; 1 &amp; 0 \\
\vdots &amp; \vdots &amp; \vdots \\
0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 1 \\
0 &amp; 0 &amp; 1 \\
\vdots &amp; \vdots &amp; \vdots \\
0 &amp; 0 &amp; 1
\end{bmatrix}
\end{align}\]</span> Then the model is written as <span class="math display">\[
\mathbf{H}\boldsymbol\tau = \mathbf{X}_{\tau}\boldsymbol\beta+\boldsymbol\eta\\
\]</span> Prior distribution <span class="math display">\[p(\boldsymbol\beta) = exp\left(-\frac{1}{2}(\boldsymbol\beta - \underline{\boldsymbol\beta})'\mathbf{\underline{V}}_\beta^{-1}(\boldsymbol\beta - \underline{\boldsymbol\beta})\right)\]</span></p>
<p>Full conditional posterior distribution <span class="math display">\[\begin{align}
p(\boldsymbol\beta|y,\boldsymbol\tau,\sigma_\eta^2) &amp;= \mathcal{N}_3(\overline{\boldsymbol\beta},\mathbf{\overline{V}}_\beta)\\[1ex]
\mathbf{\overline{V}}_{\beta} &amp;= [\sigma_{\eta}^{-2}\mathbf{X}_\tau'\mathbf{X}_\tau+\mathbf{\underline{V}}_\beta^{-1}]^{-1}\\
\bar{\boldsymbol\beta} &amp;= \mathbf{\overline{V}}_{\beta}[\sigma_{\eta}^{-2}\mathbf{X}_\tau'\mathbf{H}\boldsymbol\tau + \mathbf{\underline{V}}_\beta^{-1}\underline{\boldsymbol\beta}]
\end{align}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to draw beta</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>draw_beta <span class="ot">&lt;-</span> <span class="cf">function</span>(Tb, tau, sigma_eta_sq, beta_prior, V_prior) {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  T <span class="ot">=</span> <span class="fu">length</span>(tau)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  X_tau <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> T, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  X_tau[<span class="dv">1</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># Column for tau_0</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  X_tau[<span class="dv">1</span><span class="sc">:</span>(Tb<span class="dv">-1</span>), <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># Column for mu1 for t &lt; Tb</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  X_tau[Tb<span class="sc">:</span>T, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># Column for mu2 for t &gt;= Tb</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define H</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  H <span class="ot">&lt;-</span> <span class="fu">diag</span>(T)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>T) {</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    H[i, i<span class="dv">-1</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  V_prior_inv <span class="ot">&lt;-</span> <span class="fu">solve</span>(V_prior)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  V_bar_inv <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">/</span>sigma_eta_sq) <span class="sc">*</span> <span class="fu">t</span>(X_tau) <span class="sc">%*%</span> X_tau <span class="sc">+</span> V_prior_inv</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  V_bar <span class="ot">&lt;-</span> <span class="fu">solve</span>(V_bar_inv)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  beta_bar <span class="ot">&lt;-</span> V_bar <span class="sc">%*%</span> ((<span class="dv">1</span><span class="sc">/</span>sigma_eta_sq) <span class="sc">*</span> <span class="fu">t</span>(X_tau) <span class="sc">%*%</span> (H <span class="sc">%*%</span> tau) </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">+</span> V_prior_inv <span class="sc">%*%</span> beta_prior)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Draw a sample from the multivariate normal distribution</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  beta_posterior <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(<span class="dv">1</span>, beta_bar, V_bar)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(beta_posterior)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="student-t-error-terms" class="level2">
<h2 class="anchored" data-anchor-id="student-t-error-terms">Student-t error terms</h2>
<p>T-distributed error terms enhance robustness against outliers in data. This section outlines a method to incorporate t-distributed error terms into unobserved component models where the error term structure is as follows:</p>
<p><span class="math display">\[
\boldsymbol\epsilon\sim N_{T}(0_{T},{\sigma^{2}}diag({\boldsymbol\lambda)})
\]</span></p>
<p>where vector <span class="math inline">\(\boldsymbol\lambda = (\lambda_1, \dots, \lambda_T)'\)</span> collects th auxiliary latent variables. Each <span class="math inline">\(\lambda_{t}\)</span> follows independently the following prior: <span class="math display">\[\lambda_t\sim\mathcal{IG}2(\nu,\nu)\]</span> which makes <span class="math inline">\(\epsilon_{t}\)</span> marginally Student-t-distributed.</p>
<p>The likelihood is given by:</p>
<p><span class="math display">\[
L(\mathbf{y}|\boldsymbol\tau,\sigma^{2},\boldsymbol\lambda) = (\sigma^2)^{-\frac{T}{2}}\left(\prod_{t=1}^{T}(\lambda_{t})^{-\frac{1}{2}}\right)
\exp\left\{-\frac{1}{2}\frac{1}{\sigma^{2}}\sum_{t=1}^{T}\frac{1}{\lambda_{t}}(y_t-\tau_t)^2\right\}.
\]</span></p>
<p>The prior density of is proportional to</p>
<p><span class="math display">\[
\lambda_{t}^{-\frac{\nu+2}{2}} \exp\left\{-\frac{1}{2}\frac{\nu}{\lambda_{t}}\right\}.
\]</span></p>
<p>Combining the likelihood and the prior</p>
<p><span class="math display">\[\begin{align}
p(\lambda_{t}|y,\tau,\sigma^{2})&amp;\propto L(\lambda_{t},\tau,\sigma^{2}|y)p(\lambda_{t}|\nu_{\lambda})\\
&amp;= (\lambda_{t})^{-\frac{{1}}{2}}\exp\{-\frac{1}{2}\frac{1}{\sigma^{2}}\frac{1}{\lambda_{t}}(y-\tau)'(y-(\tau)\} \lambda_{t}^{-\frac{\nu+2}{2}} \exp\left\{-\frac{1}{2}\frac{\nu}{\lambda_{t}}\right\}
\end{align}\]</span></p>
<p>Yields the posterior kernel</p>
<p><span class="math display">\[
(\lambda_{t})^{-\frac{_{1+\nu+2}}{2}}\exp\left\{-\frac{1}{2}\frac{1}{\lambda_{t}}\left[ \nu + \frac{\epsilon_t^2}{\sigma^{2}}\right]\right\}
\]</span></p>
<p>where <span class="math inline">\(\epsilon_{t}=y_{t}-\tau_{t}\)</span>. Therefore, the full conditional posterior for each <span class="math inline">\(\lambda_t\)</span> is:</p>
<p><span class="math display">\[IG2\sim(1+\nu,\nu+\frac{\epsilon_{t}^2}{\sigma^{2}})\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>lambda_t <span class="ot">&lt;-</span> <span class="cf">function</span>(y_t,tau_t,sigma2, nu){</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  e_t     <span class="ot">&lt;-</span> y_t <span class="sc">-</span> tau_t</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  lambda  <span class="ot">&lt;-</span> MCMCpack<span class="sc">::</span><span class="fu">rinvgamma</span>(<span class="dv">1</span>, (<span class="dv">1</span> <span class="sc">+</span> nu)<span class="sc">/</span><span class="dv">2</span>, (nu <span class="sc">+</span> (e_t<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> sigma2)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lambda)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conditional-heteroskedasticity" class="level2">
<h2 class="anchored" data-anchor-id="conditional-heteroskedasticity">Conditional heteroskedasticity</h2>
<p>Modelling Conditional heteroskedasticity includes the use of Stochastic Volatility models, which provides more flexibility in forecasting, enhancing its performance, improves in-sample fit of model and estimation precision.</p>
<section id="basic-model" class="level3">
<h3 class="anchored" data-anchor-id="basic-model">Basic model</h3>
<p>Given that the shocks <span class="math inline">\(\epsilon_t\)</span> is heteroskedastic with conditional variances <span class="math inline">\(\sigma_t^2\)</span> the distribution of the shock becomes</p>
<p><span class="math display">\[
\boldsymbol \epsilon \mid \tau \sim \mathcal{N}_T \left( 0_T, \operatorname{diag}(\boldsymbol\sigma^2) \right)
\]</span> where <span class="math inline">\(\boldsymbol\sigma^2 = \left(\sigma^2_1 , \ldots, \sigma^2_T \right)\)</span> which follows a Stochastic Volatility process.</p>
<p>The likelihood function is derived as:</p>
<p><span class="math display">\[
L(\boldsymbol\tau,\sigma^2|\mathbf{y}) =
(2\pi)^{-\frac{T}{2}}\left(\operatorname{diag}(\boldsymbol\sigma^2)\right)^{-\frac{1}{2}}\exp\left\{-\frac{1}{2}(\mathbf{y} - \boldsymbol\tau)'\operatorname{diag}(\boldsymbol\sigma^2)^{-1}(\mathbf{y} - \boldsymbol\tau)\right\}.
\]</span></p>
<p>The prior distribution for <span class="math inline">\(\boldsymbol\tau\)</span> is :</p>
<p><span class="math display">\[\begin{align}
\boldsymbol\tau \mid \tau_{0}, \sigma_\eta^2 &amp;\sim \mathcal{N}_T \left( \mathbf{H}^{-1} \mathbf{i}\tau_{0}, \sigma_\eta^2 (\mathbf{H'H})^{-1} \right)\\
&amp;\propto \exp \left\{ -\frac{1}{2} \frac{1}{\sigma_\eta^2} \left( \tau - H^{-1} \mathbf{i}\tau_{0} \right)' H' H \left( \tau - H^{-1} \mathbf{i}\tau_{0}\right) \right\}
\end{align}\]</span></p>
<p>Then derive the Full Conditional Posterior for <span class="math inline">\(\boldsymbol\tau\)</span> is :</p>
<p><span class="math display">\[\begin{align}
p(\boldsymbol\tau \mid \mathbf{y},  \tau_{0}, \sigma_\eta^2, \sigma^2) &amp;\propto L(\boldsymbol\tau,\sigma^2|\mathbf{y})p(\tau \mid \tau_{0}, \sigma_\eta^2)\\
&amp;\propto exp\left\{-\frac{1}{2}(\mathbf{y} - \boldsymbol\tau)'\operatorname{diag}(\boldsymbol\sigma^2)^{-1}(\mathbf{y} - \boldsymbol\tau)\right\} \\
&amp;\qquad\exp \left\{ -\frac{1}{2} \frac{1}{\sigma_\eta^2} \left( \boldsymbol\tau - \mathbf{H}^{-1} \mathbf{i}\tau_{0} \right)' \mathbf{H' H} \left( \boldsymbol\tau - \mathbf{H}^{-1} \mathbf{i}\tau_{0}\right) \right\}
\end{align}\]</span></p>
<p>The posterior parameters for <span class="math inline">\(\tau\)</span> follows a normal distribution</p>
<p><span class="math display">\[\begin{align}
\boldsymbol\tau \mid \mathbf{y},  \tau_{0}, \sigma_\eta^2, \sigma^2&amp;\mathcal{N}_T \left( \bar{\boldsymbol\tau}, \bar{\mathbf{V}}_\tau \right)\\
\bar{\mathbf{V}}_\tau &amp;= \left[ \operatorname{diag}(\boldsymbol\sigma^2)^{-1} + \sigma_\eta^{-2} \mathbf{H' H} \right]^{-1}\\
\bar{\boldsymbol\tau} &amp;= \bar{\mathbf{V}}_\tau \left[ \operatorname{diag}(\boldsymbol\sigma^2)^{-1} \mathbf{y} + \sigma_\eta^{-2} \mathbf{H}'\mathbf{i}\tau_{0} \right]
\end{align}\]</span></p>
</section>
<section id="algorithm" class="level3">
<h3 class="anchored" data-anchor-id="algorithm">Algorithm</h3>
<p>The sampler for posterior parameters for <span class="math inline">\(\boldsymbol\tau\)</span> is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tau_hetero.sampler <span class="ot">=</span> <span class="cf">function</span>(y, aux){</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#aux includes</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sigma2 = a diagonal matrix of sigma2 from Stochastic Volatility models</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tau0 = a scalar of initial value of tau</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sigma_eta2 = a scalar sigma_eta^2</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#y = data</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  T1 <span class="ot">=</span> <span class="fu">nrow</span>(y)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># i_m = Tx1 matrix with 1 in the first row and 0 in all other rows</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  i_m <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> T1, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  i_m[<span class="dv">1</span>,] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  H                    <span class="ot">&lt;-</span>  <span class="fu">diag</span>(T1)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  mgcv<span class="sc">::</span><span class="fu">sdiag</span>(H,<span class="sc">-</span><span class="dv">1</span>)    <span class="ot">&lt;-</span>  <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a> <span class="co"># H = TxT matrix with 1 in main diagonal and -1 under the diagonal elements</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  sigma2 <span class="ot">=</span> aux<span class="sc">$</span>sigma2 </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  sigma2.inv <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">diag</span>(sigma2)) <span class="co">#get inverse </span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  tau0 <span class="ot">=</span> aux<span class="sc">$</span>tau0</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  sigma_eta2 <span class="ot">=</span> aux<span class="sc">$</span>sigma_eta2</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  sigma_eta2.inv <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>sigma_eta2 <span class="co">#get inverse</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#compute the posterior parameters</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  V_post <span class="ot">=</span> <span class="fu">solve</span>(sigma2.inv <span class="sc">+</span> sigma_eta2.inv<span class="sc">*</span><span class="fu">t</span>(H)<span class="sc">%*%</span>H)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  tau_post <span class="ot">=</span> V_post<span class="sc">%*%</span>(sigma2.inv<span class="sc">%*%</span>y <span class="sc">+</span> sigma_eta2.inv <span class="sc">*</span> <span class="fu">t</span>(H)<span class="sc">%*%</span>(i_m<span class="sc">*</span>tau0))</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#sample tau from multivariate normal and return the sample tau</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  tau_draw <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">rmvnorm</span>(T1, tau_post, V_post)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (tau_draw)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="bayesian-forecasting" class="level1">
<h1>Bayesian forecasting</h1>
<section id="predictive-density" class="level2">
<h2 class="anchored" data-anchor-id="predictive-density">Predictive density</h2>
</section>
<section id="sampling-from-the-predictive-density" class="level2">
<h2 class="anchored" data-anchor-id="sampling-from-the-predictive-density">Sampling from the predictive density</h2>
</section>
<section id="references" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="references">References</h2>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{woźniak2024,
  author = {Woźniak, Tomasz and Berke, Stephan and Chen, Gezhi and
    Gussen, Ben and Kang, Inhye and Li, Zheyuan and Liu, Rui and Pang,
    Qingqing and Pham, Nhu and Suparattanapinan, Pun and Yang, Yansong
    and Yang, Yuqiao},
  title = {Bayesian {Unobserved} {Component} {Models}},
  date = {2024-05-01},
  url = {https://donotdespair.github.io/Bayesian-Unobserved-Component-Models/},
  doi = {10.26188/25814617},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-woźniak2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Woźniak, Tomasz, Stephan Berke, Gezhi Chen, Ben Gussen, Inhye Kang,
Zheyuan Li, Rui Liu, et al. 2024. <span>“Bayesian Unobserved Component
Models.”</span> May 1, 2024. <a href="https://doi.org/10.26188/25814617">https://doi.org/10.26188/25814617</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>